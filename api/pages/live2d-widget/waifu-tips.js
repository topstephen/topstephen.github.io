{"title":"","type":"page","uid":"1cd19fc71517798e2fa5b7457d1fb06e","text":"/* * https://imjad.cn/archives/lab/add-dynamic-poster-girl-with-live2d-to-your-blog-02 * https://www.fghrsh.net/post/123.html */ function lo...","date":"2025-02-16T08:15:06.116Z","updated":"2019-07-30T02:43:28.000Z","comments":true,"path":"api/pages/live2d-widget/waifu-tips.js","covers":null,"excerpt":"","content":"<link rel=\"stylesheet\" href=\"/owl.css\"><link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"/assets/js/Meting.min.js\"></script>/*\n * https://imjad.cn/archives/lab/add-dynamic-poster-girl-with-live2d-to-your-blog-02\n * https://www.fghrsh.net/post/123.html\n */\n\nfunction loadWidget(waifuPath, apiPath) {\n\tlocalStorage.removeItem(\"waifu-display\");\n\tsessionStorage.removeItem(\"waifu-text\");\n\t$(\"body\").append(`<div id=\"waifu\">\n\t\t\t<div id=\"waifu-tips\"></div>\n\t\t\t<canvas id=\"live2d\" width=\"300\" height=\"300\"></canvas>\n\t\t\t<div id=\"waifu-tool\">\n\t\t\t\t<span class=\"fa fa-lg fa-comment\"></span>\n\t\t\t\t<span class=\"fa fa-lg fa-paper-plane\"></span>\n\t\t\t\t<span class=\"fa fa-lg fa-user-circle\"></span>\n\t\t\t\t<span class=\"fa fa-lg fa-street-view\"></span>\n\t\t\t\t<span class=\"fa fa-lg fa-camera-retro\"></span>\n\t\t\t\t<span class=\"fa fa-lg fa-info-circle\"></span>\n\t\t\t\t<span class=\"fa fa-lg fa-times\"></span>\n\t\t\t</div>\n\t\t</div>`);\n\t$(\"#waifu\").show().animate({ bottom: 0 }, 3000);\n\n\tfunction registerEventListener() {\n\t\t$(\"#waifu-tool .fa-comment\").click(showHitokoto);\n\t\t$(\"#waifu-tool .fa-paper-plane\").click(function() {\n\t\t\tvar s = document.createElement(\"script\");\n\t\t\tdocument.body.appendChild(s);\n\t\t\ts.src = \"https://cdn.jsdelivr.net/gh/GalaxyMimi/CDN/asteroids.js\";\n\t\t});\n\t\t$(\"#waifu-tool .fa-user-circle\").click(loadOtherModel);\n\t\t$(\"#waifu-tool .fa-street-view\").click(loadRandModel);\n\t\t$(\"#waifu-tool .fa-camera-retro\").click(function() {\n\t\t\tshowMessage(\"照好了嘛，是不是很可爱呢？\", 6000, 9);\n\t\t\tLive2D.captureName = \"photo.png\";\n\t\t\tLive2D.captureFrame = true;\n\t\t});\n\t\t$(\"#waifu-tool .fa-info-circle\").click(function() {\n\t\t\topen(\"https://github.com/stevenjoezhang/live2d-widget\");\n\t\t});\n\t\t$(\"#waifu-tool .fa-times\").click(function() {\n\t\t\tlocalStorage.setItem(\"waifu-display\", new Date().getTime());\n\t\t\tshowMessage(\"愿你有一天能与重要的人重逢。\", 2000, 11);\n\t\t\t$(\"#waifu\").animate({ bottom: -500 }, 3000, function() {\n\t\t\t\t$(\"#waifu\").hide();\n\t\t\t\t$(\"#waifu-toggle\").show().animate({ \"margin-left\": -50 }, 1000);\n\t\t\t});\n\t\t});\n\t\tvar re = /x/;\n\t\tconsole.log(re);\n\t\tre.toString = function() {\n\t\t\tshowMessage(\"哈哈，你打开了控制台，是想要看看我的秘密吗？\", 6000, 9);\n\t\t\treturn \"\";\n\t\t};\n\t\t$(document).on(\"copy\", function() {\n\t\t\tshowMessage(\"你都复制了些什么呀，转载要记得加上出处哦！\", 6000, 9);\n\t\t});\n\t\t$(document).on(\"visibilitychange\", function() {\n\t\t\tif (!document.hidden) showMessage(\"哇，你终于回来了～\", 6000, 9);\n\t\t});\n\t}\n\tregisterEventListener();\n\n\tfunction welcomeMessage() {\n\t\tvar SiteIndexUrl = location.port ? `${location.protocol}//${location.hostname}:${location.port}/` : `${location.protocol}//${location.hostname}/`, text; //自动获取主页\n\t\tif (location.href == SiteIndexUrl) { //如果是主页\n\t\t\tvar now = new Date().getHours();\n\t\t\tif (now > 23 || now <= 5) text = \"你是夜猫子呀？这么晚还不睡觉，明天起的来嘛？\";\n\t\t\telse if (now > 5 && now <= 7) text = \"早上好！一日之计在于晨，美好的一天就要开始了。\";\n\t\t\telse if (now > 7 && now <= 11) text = \"上午好！工作顺利嘛，不要久坐，多起来走动走动哦！\";\n\t\t\telse if (now > 11 && now <= 14) text = \"中午了，工作了一个上午，现在是午餐时间！\";\n\t\t\telse if (now > 14 && now <= 17) text = \"午后很容易犯困呢，今天的运动目标完成了吗？\";\n\t\t\telse if (now > 17 && now <= 19) text = \"傍晚了！窗外夕阳的景色很美丽呢，最美不过夕阳红～\";\n\t\t\telse if (now > 19 && now <= 21) text = \"晚上好，今天过得怎么样？\";\n\t\t\telse if (now > 21 && now <= 23) text = [\"已经这么晚了呀，早点休息吧，晚安～\", \"深夜时要爱护眼睛呀！\"];\n\t\t\telse text = \"好久不见，日子过得好快呢……\";\n\t\t}\n\t\telse if (document.referrer !== \"\") {\n\t\t\tvar referrer = document.createElement(\"a\");\n\t\t\treferrer.href = document.referrer;\n\t\t\tvar domain = referrer.hostname.split(\".\")[1];\n\t\t\tif (location.hostname == referrer.hostname) text = `欢迎阅读<span style=\"color:#0099cc;\">『${document.title.split(\" - \")[0]}』</span>`;\n\t\t\telse if (domain == \"baidu\") text = `Hello！来自 百度搜索 的朋友<br/>你是搜索 <span style=\"color:#0099cc;\">${referrer.search.split(\"&wd=\")[1].split(\"&\")[0]}</span> 找到的我吗？`;\n\t\t\telse if (domain == \"so\") text = `Hello！来自 360搜索 的朋友<br/>你是搜索 <span style=\"color:#0099cc;\">${referrer.search.split(\"&q=\")[1].split(\"&\")[0]}</span> 找到的我吗？`;\n\t\t\telse if (domain == \"google\") text = `Hello！来自 谷歌搜索 的朋友<br/>欢迎阅读<span style=\"color:#0099cc;\">『${document.title.split(\" - \")[0]}』</span>`;\n\t\t\telse text = `Hello！来自 <span style=\"color:#0099cc;\">${referrer.hostname}</span> 的朋友`;\n\t\t}\n\t\telse {\n\t\t\ttext = `欢迎阅读<span style=\"color:#0099cc;\">『${document.title.split(\" - \")[0]}』</span>`;\n\t\t}\n\t\tshowMessage(text, 7000, 8);\n\t}\n\twelcomeMessage();\n\t//检测用户活动状态，并在空闲时定时显示一言\n\tvar userAction = false,\n\t\thitokotoTimer = null,\n\t\tmessageTimer = null,\n\t\tmessageArray = [\"已经过了这么久了呀，日子过得好快呢……\", \"大坏蛋！你都多久没碰人家了呀，嘤嘤嘤～\", \"嗨～快来逗我玩吧！\", \"拿小拳拳锤你胸口！\"];\n\tif ($(\".fa-share-alt\").is(\":hidden\")) messageArray.push(\"记得把小家加入Adblock白名单哦！\");\n\t$(document).mousemove(function() {\n\t\tuserAction = true;\n\t}).keydown(function() {\n\t\tuserAction = true;\n\t});\n\tsetInterval(function() {\n\t\tif (!userAction) {\n\t\t\tif (!hitokotoTimer) hitokotoTimer = setInterval(showHitokoto, 25000);\n\t\t}\n\t\telse {\n\t\t\tuserAction = false;\n\t\t\tclearInterval(hitokotoTimer);\n\t\t\thitokotoTimer = null;\n\t\t}\n\t}, 1000);\n\n\tfunction showHitokoto() {\n\t\t//增加 hitokoto.cn 的 API\n\t\tif (Math.random() < 0.6 && messageArray.length > 0) showMessage(messageArray[Math.floor(Math.random() * messageArray.length)], 6000, 9);\n\t\telse $.getJSON(\"https://v1.hitokoto.cn\", function(result) {\n\t\t\t\tvar text = `这句一言来自 <span style=\"color:#0099cc;\">『${result.from}』</span>，是 <span style=\"color:#0099cc;\">${result.creator}</span> 在 hitokoto.cn 投稿的。`;\n\t\t\tshowMessage(result.hitokoto, 6000, 9);\n\t\t\tsetTimeout(function() {\n\t\t\t\tshowMessage(text, 4000, 9);\n\t\t\t}, 6000);\n\t\t});\n\t}\n\n\tfunction showMessage(text, timeout, priority) {\n\t\tif (!text) return;\n\t\tif (!sessionStorage.getItem(\"waifu-text\") || sessionStorage.getItem(\"waifu-text\") <= priority) {\n\t\t\tif (messageTimer) {\n\t\t\t\tclearTimeout(messageTimer);\n\t\t\t\tmessageTimer = null;\n\t\t\t}\n\t\t\tif (Array.isArray(text)) text = text[Math.floor(Math.random() * text.length)];\n\t\t\tsessionStorage.setItem(\"waifu-text\", priority);\n\t\t\t$(\"#waifu-tips\").stop().html(text).fadeTo(200, 1);\n\t\t\tmessageTimer = setTimeout(function() {\n\t\t\t\tsessionStorage.removeItem(\"waifu-text\");\n\t\t\t\t$(\"#waifu-tips\").fadeTo(1000, 0);\n\t\t\t}, timeout);\n\t\t}\n\t}\n\n\tfunction initModel() {\n\t\tvar modelId = localStorage.getItem(\"modelId\"),\n\t\t\tmodelTexturesId = localStorage.getItem(\"modelTexturesId\");\n\t\tif (modelId == null) {\n\t\t\t//首次访问加载 指定模型 的 指定材质\n\t\t\tvar modelId = 1, //模型 ID\n\t\t\t\tmodelTexturesId = 53; //材质 ID\n\t\t}\n\t\tloadModel(modelId, modelTexturesId);\n\t\t$.getJSON(waifuPath, function(result) {\n\t\t\t$.each(result.mouseover, function(index, tips) {\n\t\t\t\t$(document).on(\"mouseover\", tips.selector, function() {\n\t\t\t\t\tvar text = Array.isArray(tips.text) ? tips.text[Math.floor(Math.random() * tips.text.length)] : tips.text;\n\t\t\t\t\ttext = text.replace(\"{text}\", $(this).text());\n\t\t\t\t\tshowMessage(text, 4000, 8);\n\t\t\t\t});\n\t\t\t});\n\t\t\t$.each(result.click, function(index, tips) {\n\t\t\t\t$(document).on(\"click\", tips.selector, function() {\n\t\t\t\t\tvar text = Array.isArray(tips.text) ? tips.text[Math.floor(Math.random() * tips.text.length)] : tips.text;\n\t\t\t\t\ttext = text.replace(\"{text}\", $(this).text());\n\t\t\t\t\tshowMessage(text, 4000, 8);\n\t\t\t\t});\n\t\t\t});\n\t\t\t$.each(result.seasons, function(index, tips) {\n\t\t\t\tvar now = new Date(),\n\t\t\t\t\tafter = tips.date.split(\"-\")[0],\n\t\t\t\t\tbefore = tips.date.split(\"-\")[1] || after;\n\t\t\t\tif ((after.split(\"/\")[0] <= now.getMonth() + 1 && now.getMonth() + 1 <= before.split(\"/\")[0]) && (after.split(\"/\")[1] <= now.getDate() && now.getDate() <= before.split(\"/\")[1])) {\n\t\t\t\t\tvar text = Array.isArray(tips.text) ? tips.text[Math.floor(Math.random() * tips.text.length)] : tips.text;\n\t\t\t\t\ttext = text.replace(\"{year}\", now.getFullYear());\n\t\t\t\t\t//showMessage(text, 7000, true);\n\t\t\t\t\tmessageArray.push(text);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tinitModel();\n\n\tfunction loadModel(modelId, modelTexturesId) {\n\t\tlocalStorage.setItem(\"modelId\", modelId);\n\t\tif (modelTexturesId === undefined) modelTexturesId = 0;\n\t\tlocalStorage.setItem(\"modelTexturesId\", modelTexturesId);\n\t\tloadlive2d(\"live2d\", `${apiPath}/get/?id=${modelId}-${modelTexturesId}`, console.log(`Live2D 模型 ${modelId}-${modelTexturesId} 加载完成`));\n\t}\n\n\tfunction loadRandModel() {\n\t\tvar modelId = localStorage.getItem(\"modelId\"),\n\t\t\tmodelTexturesId = localStorage.getItem(\"modelTexturesId\");\n\t\t\t//可选 \"rand\"(随机), \"switch\"(顺序)\n\t\t$.ajax({\n\t\t\tcache: false,\n\t\t\turl: `${apiPath}/rand_textures/?id=${modelId}-${modelTexturesId}`,\n\t\t\tdataType: \"json\",\n\t\t\tsuccess: function(result) {\n\t\t\t\tif (result.textures[\"id\"] == 1 && (modelTexturesId == 1 || modelTexturesId == 0)) showMessage(\"我还没有其他衣服呢！\", 4000, 10);\n\t\t\t\telse showMessage(\"我的新衣服好看嘛？\", 4000, 10);\n\t\t\t\tloadModel(modelId, result.textures[\"id\"]);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction loadOtherModel() {\n\t\tvar modelId = localStorage.getItem(\"modelId\");\n\t\t$.ajax({\n\t\t\tcache: false,\n\t\t\turl: `${apiPath}/switch/?id=${modelId}`,\n\t\t\tdataType: \"json\",\n\t\t\tsuccess: function(result) {\n\t\t\t\tloadModel(result.model[\"id\"]);\n\t\t\t\tshowMessage(result.model[\"message\"], 4000, 10);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction initWidget(waifuPath = \"/waifu-tips.json\", apiPath = \"\") {\n\tif (screen.width <= 768) return;\n\t$(\"body\").append(`<div id=\"waifu-toggle\" style=\"margin-left: -100px;\">\n\t\t\t<span>看板娘</span>\n\t\t</div>`);\n\t$(\"#waifu-toggle\").hover(function() {\n\t\t$(\"#waifu-toggle\").animate({ \"margin-left\": -30 }, 500);\n\t}, function() {\n\t\t$(\"#waifu-toggle\").animate({ \"margin-left\": -50 }, 500);\n\t}).click(function() {\n\t\t$(\"#waifu-toggle\").animate({ \"margin-left\": -100 }, 1000, function() {\n\t\t\t$(\"#waifu-toggle\").hide();\n\t\t});\n\t\tif ($(\"#waifu-toggle\").attr(\"first-time\")) {\n\t\t\tloadWidget(waifuPath, apiPath);\n\t\t\t$(\"#waifu-toggle\").attr(\"first-time\", false);\n\t\t}\n\t\telse {\n\t\t\tlocalStorage.removeItem(\"waifu-display\");\n\t\t\t$(\"#waifu\").show().animate({ bottom: 0 }, 3000);\n\t\t}\n\t});\n\tif (localStorage.getItem(\"waifu-display\") && new Date().getTime() - localStorage.getItem(\"waifu-display\") <= 86400000) {\n\t\t$(\"#waifu-toggle\").attr(\"first-time\", true).css({ \"margin-left\": -50 });\n\t}\n\telse {\n\t\tloadWidget(waifuPath, apiPath);\n\t}\n}\n","count_time":{"symbolsCount":"4.7k","symbolsTime":"4 mins."},"toc":"","data":[]}