{"title":"MYSQL-性能优化篇","uid":"4e6d25d934b34d1d1306ad13dba25eb2","slug":"csdn/MYSQL-性能优化篇","date":"2023-03-20T13:00:38.000Z","updated":"2025-02-17T01:58:21.593Z","comments":true,"path":"api/articles/csdn/MYSQL-性能优化篇.json","keywords":"Stephen web3","cover":[],"content":"<link rel=\"stylesheet\" href=\"/owl.css\"><link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"/assets/js/Meting.min.js\"></script><span id=\"more\"></span>\n\n<p><strong>目录</strong></p>\n<p><a href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96%EF%BC%9F\">为什么要进行数据库优化？</a></p>\n<p><a href=\"#mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96\">mysql数据库优化</a></p>\n<p><a href=\"#SQL%E5%8F%8A%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96\">SQL及索引优化</a></p>\n<p><a href=\"#mysql%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD%EF%BC%88linux%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD%EF%BC%89\">mysql安装与卸载（linux在线安装与卸载）</a></p>\n<p><a href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E9%80%89%E6%8B%A9\">数据库版本选择</a></p>\n<p><a href=\"#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE\">准备数据</a></p>\n<p><a href=\"#%E8%A1%A8%E7%BB%93%E6%9E%84%E5%85%B3%E7%B3%BB\">表结构关系</a></p>\n<p><a href=\"#%E5%A6%82%E4%BD%95%E5%8F%91%E7%8E%B0%E6%9C%89%E9%97%AE%E9%A2%98%E7%9A%84SQL\">如何发现有问题的SQL</a></p>\n<p><a href=\"#%E6%A3%80%E6%9F%A5%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%EF%BC%9A\">检查慢查日志是否开启：</a></p>\n<p><a href=\"#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E6%97%A5%E5%BF%97%E7%9A%84%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF\">查看所有日志的变量信息</a></p>\n<p><a href=\"#MySQL%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E7%9A%84%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F\">MySQL慢查日志的存储格式</a></p>\n<p><a href=\"#MySQL%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%88mysqldumpslow%EF%BC%89\">MySQL慢查日志分析工具（mysqldumpslow）</a></p>\n<p><a href=\"#%E4%BB%8B%E7%BB%8D\">介绍</a></p>\n<p><a href=\"#%E7%94%A8%E6%B3%95\">用法</a></p>\n<p><a href=\"#MySQL%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7(pt-query-digest)\">MySQL慢查日志分析工具(pt-query-digest)</a></p>\n<p><a href=\"#%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%9C%E7%94%A8\">介绍及作用</a></p>\n<p><a href=\"#%E5%AE%89%E8%A3%85pt-query-digest%E5%B7%A5%E5%85%B7\">安装pt-query-digest工具</a></p>\n<p><a href=\"#%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%EF%BC%88%E6%B3%A8%EF%BC%9A%E5%BF%85%E9%A1%BB%E5%85%88%E8%A6%81%E5%AE%89%E8%A3%85wget%EF%BC%89\">快速安装（注：必须先要安装wget）</a></p>\n<p><a href=\"#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%EF%BC%9A\">检查是否安装完成：</a></p>\n<p><a href=\"#%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E7%AE%80%E4%BB%8B%EF%BC%9A\">工具使用简介：</a></p>\n<p><a href=\"#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E5%8F%91%E7%8E%B0%E6%9C%89%E9%97%AE%E9%A2%98%E7%9A%84SQL\">如何通过慢查日志发现有问题的SQL</a></p>\n<p><a href=\"#%E6%9F%A5%E8%AF%A2%E6%AC%A1%E6%95%B0%E5%A4%9A%E4%B8%94%E6%AF%8F%E6%AC%A1%E6%9F%A5%E8%AF%A2%E5%8D%A0%E7%94%A8%E6%97%B6%E9%97%B4%E9%95%BF%E7%9A%84sql\">查询次数多且每次查询占用时间长的sql</a></p>\n<p><a href=\"#IO%E5%A4%A7%E7%9A%84sql\">IO大的sql</a></p>\n<p><a href=\"#%E6%9C%AA%E5%91%BD%E4%B8%AD%E7%9A%84%E7%B4%A2%E5%BC%95%E7%9A%84SQL\">未命中的索引的SQL</a></p>\n<p><a href=\"#%E9%80%9A%E8%BF%87explain%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\">通过explain查询分析SQL的执行计划</a></p>\n<p><a href=\"#%E4%BD%BF%E7%94%A8explain%E6%9F%A5%E8%AF%A2SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\">使用explain查询SQL的执行计划</a></p>\n<p><a href=\"#%E6%AF%8F%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E8%AF%B4%E6%98%8E%EF%BC%9A\">每个字段的说明：</a></p>\n<p><a href=\"#%E5%85%B7%E4%BD%93%E6%85%A2%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B\">具体慢查询的优化案例</a></p>\n<p><a href=\"#%E5%87%BD%E6%95%B0Max()%E7%9A%84%E4%BC%98%E5%8C%96\">函数Max()的优化</a></p>\n<p><a href=\"#%E5%87%BD%E6%95%B0Count()%E7%9A%84%E4%BC%98%E5%8C%96\">函数Count()的优化</a></p>\n<p><a href=\"#%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E5%8C%96\">子查询的优化</a></p>\n<p><a href=\"#group%20by%E7%9A%84%E4%BC%98%E5%8C%96\">group by的优化</a></p>\n<p><a href=\"#Limit%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E5%8C%96\">Limit查询的优化</a></p>\n<p><a href=\"#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BC%98%E5%8C%96\">索引的优化</a></p>\n<hr>\n<h2 id=\"为什么要进行数据库优化？\"><a href=\"#为什么要进行数据库优化？\" class=\"headerlink\" title=\"为什么要进行数据库优化？\"></a><strong><strong><strong>为什么要进行数据库优化？</strong></strong></strong></h2><p>1.避免网站页面出现访问错误</p>\n<p>        由于数据库连接timeout产生页面5xx错误</p>\n<p>        由于慢查询造成页面无法加载</p>\n<p>        由于阻塞造成数据无法提交</p>\n<p>2.增加数据库的稳定性</p>\n<p>        很多数据库问题都是由于低效的查询引起的</p>\n<p>3.优化用户体验</p>\n<p>        流畅页面的访问速度</p>\n<p>        良好的网站功能体验</p>\n<h2 id=\"mysql数据库优化\"><a href=\"#mysql数据库优化\" class=\"headerlink\" title=\"mysql数据库优化\"></a><strong><strong><strong>mysql数据库优化</strong></strong></strong></h2><p>可以从哪几个方面进行数据库的优化？如下图所示：</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/cbee761baa8b4065e4dff90876be0fd1.png\"></p>\n<p>1.SQL及索引优化</p>\n<p>        根据需求写出良好的SQL，并创建有效的索引，实现某一种需求可以多种写法，这时候我们就要选择一种效率最高的写法。这个时候就要了解sql优化</p>\n<p>2.数据库表结构优化</p>\n<p>        根据数据库的范式，设计表结构，表结构设计的好直接关系到写SQL语句。</p>\n<p>3.系统配置优化</p>\n<p>        大多数运行在Linux机器上，如tcp连接数的限制、打开文件数的限制、安全性的限制，因此我们要对这些配置进行相应的优化。</p>\n<p>4.硬件配置优化</p>\n<p>        选择适合数据库服务的cpu，更快的IO，更高的内存；cpu并不是越多越好，某些数据库版本有最大的限制，ＩＯ操作并不是减少阻塞。</p>\n<p>注：通过上图可以看出，该金字塔中，优化的成本从下而上逐渐增高，而优化的效果会逐渐降低。</p>\n<h2 id=\"SQL及索引优化\"><a href=\"#SQL及索引优化\" class=\"headerlink\" title=\"SQL及索引优化\"></a><strong><strong><strong>SQL及索引优化</strong></strong></strong></h2><h3 id=\"mysql安装与卸载（linux在线安装与卸载）\"><a href=\"#mysql安装与卸载（linux在线安装与卸载）\" class=\"headerlink\" title=\"mysql安装与卸载（linux在线安装与卸载）\"></a><strong><strong><strong>mysql安装与卸载（linux在线安装与卸载）</strong></strong></strong></h3><h3 id=\"数据库版本选择\"><a href=\"#数据库版本选择\" class=\"headerlink\" title=\"数据库版本选择\"></a><strong><strong><strong>数据库版本选择</strong></strong></strong></h3><p>1、查看数据库的版本</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> @@</span><span style=\"color: #F78C6C\">version</span><span style=\"color: #BABED8\">;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/1672e773585c748686fd7e8360ea8cf0.png\"></p>\n<h3 id=\"准备数据\"><a href=\"#准备数据\" class=\"headerlink\" title=\"准备数据\"></a><strong><strong><strong>准备数据</strong></strong></strong></h3><p><strong><strong>网址：</strong>****<strong><a href=\"https://dev.mysql.com/doc/sakila/en/sakila-installation.html\">https://dev.mysql.com/doc/sakila/en/sakila-installation.html</a></strong></strong></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/4c9d49e12ef9f8d93d721b66756e2f9a.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/84bfb625852ab4d1e56763cc71aaf47c.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/cd5b7f473a7b2869ce4eabd4ab95c20b.png\"></p>\n<p>sakila-db.zip压缩包所包含的文件如下解释</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/632ba846399d371415a66bf7c7ace62c.png\"></p>\n<p>加载数据</p>\n<p>步骤如下图所示</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/a128fdd160d6e8f77d9e5a0997f0ab18.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/ca501f445c34471aa6fe4346c766d31e.png\"> <img src=\"https://i-blog.csdnimg.cn/blog_migrate/8744617a9c66fa890209b0cd8778a3ed.png\"></p>\n<h3 id=\"表结构关系\"><a href=\"#表结构关系\" class=\"headerlink\" title=\"表结构关系\"></a><strong><strong><strong>表结构关系</strong></strong></strong></h3><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/32d9803eb4c6ec907fc1c9b5012ffec9.png\"></p>\n<p>注：该表结构关系是用工具生成的。</p>\n<h3 id=\"如何发现有问题的SQL\"><a href=\"#如何发现有问题的SQL\" class=\"headerlink\" title=\"如何发现有问题的SQL\"></a><strong><strong><strong>如何发现有问题的SQL</strong></strong></strong></h3><p>MySQL慢查日志的开启方式和存储格式</p>\n<h4 id=\"检查慢查日志是否开启：\"><a href=\"#检查慢查日志是否开启：\" class=\"headerlink\" title=\"检查慢查日志是否开启：\"></a><strong><strong><strong>检查慢查日志是否开启：</strong></strong></strong></h4><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">show variables </span><span style=\"color: #F78C6C\">like</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">slow_query_log</span><span style=\"color: #89DDFF\">&#39;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/d455378bbde348d0034703e42ecc3cbd.png\"></p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">show variables </span><span style=\"color: #F78C6C\">like</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">slow_query_log</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">  </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #BABED8\">查看是否开启慢查询日志</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">global</span><span style=\"color: #BABED8\"> slow_query_log_file</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\"> /usr/share/mysql/sql_log/mysql-slow.log</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #BABED8\">慢查询日志的位置</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">global</span><span style=\"color: #BABED8\"> log_queries_not_using_indexes</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">on</span><span style=\"color: #BABED8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #BABED8\">开启慢查询日志</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">global</span><span style=\"color: #BABED8\"> long_query_time</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">;  </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #BABED8\">大于1秒钟的数据记录到慢日志中，如果设置为默认0，则会有大量的信息存储在磁盘中，磁盘很容易满掉</span></span></code></pre></div><h4 id=\"查看所有日志的变量信息\"><a href=\"#查看所有日志的变量信息\" class=\"headerlink\" title=\"查看所有日志的变量信息\"></a><strong><strong><strong>查看所有日志的变量信息</strong></strong></strong></h4><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">show variables </span><span style=\"color: #F78C6C\">like</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">%log%</span><span style=\"color: #89DDFF\">&#39;</span></span></code></pre></div><div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">mysql</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> show variables </span><span style=\"color: #F78C6C\">like</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">%log%</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">+</span><span style=\"color: #676E95; font-style: italic\">-----------------------------------------+------------------------------------+</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| Variable_name                           | </span><span style=\"color: #F78C6C\">Value</span><span style=\"color: #BABED8\">                              |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">+</span><span style=\"color: #676E95; font-style: italic\">-----------------------------------------+------------------------------------+</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| back_log                                | </span><span style=\"color: #F78C6C\">80</span><span style=\"color: #BABED8\">                                 |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_cache_size                       | </span><span style=\"color: #F78C6C\">32768</span><span style=\"color: #BABED8\">                              |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_checksum                         | CRC32                              |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_direct_non_transactional_updates | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_error_action                     | IGNORE_ERROR                       |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_format                           | </span><span style=\"color: #F78C6C\">STATEMENT</span><span style=\"color: #BABED8\">                          |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_gtid_simple_recovery             | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_max_flush_queue_time             | </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_order_commits                    | </span><span style=\"color: #F78C6C\">ON</span><span style=\"color: #BABED8\">                                 |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_row_image                        | FULL                               |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_rows_query_log_events            | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlog_stmt_cache_size                  | </span><span style=\"color: #F78C6C\">32768</span><span style=\"color: #BABED8\">                              |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| binlogging_impossible_mode              | IGNORE_ERROR                       |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| expire_logs_days                        | </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| general_log                             | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| general_log_file                        | </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">var</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">lib</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">mysql</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">mysql</span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\">host.log      |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_api_enable_binlog                | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_flush_log_at_timeout             | </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_flush_log_at_trx_commit          | </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_locks_unsafe_for_binlog          | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_log_buffer_size                  | </span><span style=\"color: #F78C6C\">8388608</span><span style=\"color: #BABED8\">                            |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_log_compressed_pages             | </span><span style=\"color: #F78C6C\">ON</span><span style=\"color: #BABED8\">                                 |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_log_file_size                    | </span><span style=\"color: #F78C6C\">50331648</span><span style=\"color: #BABED8\">                           |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_log_files_in_group               | </span><span style=\"color: #F78C6C\">2</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_log_group_home_dir               | .</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">                                 |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_mirrored_log_groups              | </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_online_alter_log_max_size        | </span><span style=\"color: #F78C6C\">134217728</span><span style=\"color: #BABED8\">                          |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| innodb_undo_logs                        | </span><span style=\"color: #F78C6C\">128</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_bin                                 | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_bin_basename                        |                                    |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_bin_index                           |                                    |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_bin_trust_function_creators         | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_bin_use_v1_row_events               | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_error                               | </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">var</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #F78C6C\">log</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">mysqld.log                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_output                              | </span><span style=\"color: #F78C6C\">FILE</span><span style=\"color: #BABED8\">                               |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_queries_not_using_indexes           | </span><span style=\"color: #F78C6C\">ON</span><span style=\"color: #BABED8\">                                 |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_slave_updates                       | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_slow_admin_statements               | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_slow_slave_statements               | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_throttle_queries_not_using_indexes  | </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| log_warnings                            | </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| max_binlog_cache_size                   | </span><span style=\"color: #F78C6C\">18446744073709547520</span><span style=\"color: #BABED8\">               |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| max_binlog_size                         | </span><span style=\"color: #F78C6C\">1073741824</span><span style=\"color: #BABED8\">                         |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| max_binlog_stmt_cache_size              | </span><span style=\"color: #F78C6C\">18446744073709547520</span><span style=\"color: #BABED8\">               |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| max_relay_log_size                      | </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| relay_log                               |                                    |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| relay_log_basename                      |                                    |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| relay_log_index                         |                                    |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| relay_log_info_file                     | relay</span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\">log.info                     |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| relay_log_info_repository               | </span><span style=\"color: #F78C6C\">FILE</span><span style=\"color: #BABED8\">                               |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| relay_log_purge                         | </span><span style=\"color: #F78C6C\">ON</span><span style=\"color: #BABED8\">                                 |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| relay_log_recovery                      | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| relay_log_space_limit                   | </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| simplified_binlog_gtid_recovery         | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| slow_query_log                          | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| slow_query_log_file                     | </span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">var</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">lib</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">mysql</span><span style=\"color: #89DDFF\">/</span><span style=\"color: #BABED8\">mysql</span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\">host</span><span style=\"color: #89DDFF\">-</span><span style=\"color: #BABED8\">slow.log |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| sql_log_bin                             | </span><span style=\"color: #F78C6C\">ON</span><span style=\"color: #BABED8\">                                 |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| sql_log_off                             | </span><span style=\"color: #F78C6C\">OFF</span><span style=\"color: #BABED8\">                                |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| sync_binlog                             | </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">                                  |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| sync_relay_log                          | </span><span style=\"color: #F78C6C\">10000</span><span style=\"color: #BABED8\">                              |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">| sync_relay_log_info                     | </span><span style=\"color: #F78C6C\">10000</span><span style=\"color: #BABED8\">                              |</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">+</span><span style=\"color: #676E95; font-style: italic\">-----------------------------------------+------------------------------------+</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">61</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">rows</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">set</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\">.</span><span style=\"color: #F78C6C\">01</span><span style=\"color: #BABED8\"> sec)</span></span></code></pre></div><p>开启慢查日志：</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">show variables </span><span style=\"color: #F78C6C\">like</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">slow_query_log</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">  </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #BABED8\">查看是否开启慢查询日志</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">global</span><span style=\"color: #BABED8\"> slow_query_log_file</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\"> /var/lib/mysql/mysql-host-slow.log </span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #BABED8\">慢查询日志的位置</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">global</span><span style=\"color: #BABED8\"> log_queries_not_using_indexes</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">on</span><span style=\"color: #BABED8\">;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #BABED8\">开启慢查询日志</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">global</span><span style=\"color: #BABED8\"> long_query_time</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">;  </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">//</span><span style=\"color: #BABED8\">大于1秒钟的数据记录到慢日志中，如果设置为默认0，则会有大量的信息存储在磁盘中，磁盘很容易满掉</span></span></code></pre></div><p>验证慢查询日志是否开启：</p>\n<p>在mysql操作中，</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">show databases;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">use</span><span style=\"color: #BABED8\"> sakila;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> store;</span></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> staff;</span></span></code></pre></div><p>监听日志文件，看是否写入</p>\n<p>tail -50f &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-host-slow.log</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/36b82fcbf82a2e46507eee320c32aaf1.png\"></p>\n<h4 id=\"MySQL慢查日志的存储格式\"><a href=\"#MySQL慢查日志的存储格式\" class=\"headerlink\" title=\"MySQL慢查日志的存储格式\"></a><strong><strong><strong>MySQL慢查日志的存储格式</strong></strong></strong></h4><p>如下图所示：</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/2bd76d97c235d2e3f6feaea594da0dce.png\"></p>\n<p>说明：</p>\n<p>1、# Time: 180526  1:06:54 -——&gt;查询的执行时间</p>\n<p>2、# User@Host: root[root] @ localhost []  Id:     4 -——&gt;执行sql的主机信息</p>\n<p>3、# Query_time: 0.000401  Lock_time: 0.000105 Rows_sent: 2  Rows_examined: 2——-&gt;SQL的执行信息：</p>\n<p>Query_time：SQL的查询时间</p>\n<p>Lock_time：锁定时间</p>\n<p>Rows_sent：所发送的行数</p>\n<p>Rows_examined：锁扫描的行数</p>\n<p>4、SET timestamp&#x3D;1527268014; -——&gt;SQL执行时间</p>\n<p>5、select * from staff; -——&gt;SQL的执行内容</p>\n<h2 id=\"MySQL慢查日志分析工具（mysqldumpslow）\"><a href=\"#MySQL慢查日志分析工具（mysqldumpslow）\" class=\"headerlink\" title=\"MySQL慢查日志分析工具（mysqldumpslow）****\"></a><strong><strong><strong>MySQL慢查日志分析工具</strong></strong></strong><strong>（</strong><strong><strong><strong>mysqldumpslow</strong></strong></strong><strong>）</strong>****</h2><h3 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a><strong><strong><strong>介绍</strong></strong></strong></h3><p>        如何进行查看慢查询日志，如果开启了慢查询日志，就会生成很多的数据，然后我们就可以通过对日志的分析，生成分析报表，然后通过报表进行优化。</p>\n<h3 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a><strong><strong><strong>用法</strong></strong></strong></h3><p>接下来我们查看一下这个工具的用法：</p>\n<p>注意：在mysql数据库所在的服务器上，而不是在mysql&gt;命令行中</p>\n<p>该工具如何使用：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>mysqldumpslow****-h</strong></p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/3fac7152bc100ab2d8208069b7fdaa8c.png\"></p>\n<p><strong>查看verbose信息</strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>M<strong><strong>ysqldump</strong></strong>slow -v</strong></p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/8737354d48a22cf67363c192e1b57bec.png\"></p>\n<p>查看慢查询日志的前10个，mysqldumpslow 分析的结果如下</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>mysqldumpslow -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-slow.log</strong></p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/dad82f0a80fddf999d79dbbff3653efb.png\"></p>\n<p>如上图两条就是分析的结果，每条结果都显示是执行时间，锁定时间，发送的行数，扫描的行数</p>\n<p>这个工具是最常用的工具，通过安装mysql进行附带安装，但是该工具统计的结果比较少，对我们的优化锁表现的数据还是比较少。</p>\n<h2 id=\"MySQL慢查日志分析工具-pt-query-digest\"><a href=\"#MySQL慢查日志分析工具-pt-query-digest\" class=\"headerlink\" title=\"MySQL慢查日志分析工具(pt-query-digest)\"></a><strong><strong><strong>MySQL慢查日志分析工具(pt-query-digest)</strong></strong></strong></h2><h3 id=\"介绍及作用\"><a href=\"#介绍及作用\" class=\"headerlink\" title=\"介绍及作用\"></a><strong><strong><strong>介绍及作用</strong></strong></strong></h3><p>        作为一名优秀的mysql dba也需要有掌握几个好用的mysql管理工具，所以我也一直在整理和查找一些能够便于管理mysql的利器。以后的一段时间内，将会花一大部分的精力去搜索这些工具。</p>\n<p>        性能的管理一直都是摆在第一位的，dba的很多工作管理层都看不到也没有办法衡量价值，但是如果一个系统慢的跟蜗牛一样，dba通过监控调优把系统从崩溃边 缘重新拉回到高铁时代。这种价值和触动应该是巨大的。（很多企业的领导认为系统跑不动了就需要换更快的CPU、更大的内存、更快的存储，而且这还不是少 数，所以DBA的价值也一直体现不出来，薪水自然也就不会很高）</p>\n<p>        mysql 的日志是跟踪mysql性能瓶颈的最快和最直接的方式了，系统性能出现瓶颈的时候，首先要打开慢查询日志，进行跟踪；这段时间关于慢查询日志的管理和查看 已经整理过两篇文章了，不经意间又发现了一个查看慢查询日志的工具：mk-query-digest，这个工具网上号称mysql dba必须掌握的十大工具之首。</p>\n<h3 id=\"安装pt-query-digest工具\"><a href=\"#安装pt-query-digest工具\" class=\"headerlink\" title=\"安装pt-query-digest工具\"></a><strong><strong><strong>安装</strong></strong></strong><strong>pt-query-digest</strong><strong><strong><strong>工具</strong></strong></strong></h3><h4 id=\"快速安装（注：必须先要安装wget）\"><a href=\"#快速安装（注：必须先要安装wget）\" class=\"headerlink\" title=\"快速安装（注：必须先要安装wget）\"></a><strong><strong><strong>快速安装（注：必须先要安装wget）</strong></strong></strong></h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>wget <a href=\"https://www.percona.com/downloads/percona-toolkit/2.2.16/RPM/percona-toolkit-2.2.16-1.noarch.rpm\">https://www.percona.com/downloads/percona-toolkit/2.2.16/RPM/percona-toolkit-2.2.16-1.noarch.rpm</a> &amp;&amp; yum localinstall -y  percona-toolkit-2.2.16-1.noarch.rpm</p></blockquote>\n<h4 id=\"检查是否安装完成：\"><a href=\"#检查是否安装完成：\" class=\"headerlink\" title=\"检查是否安装完成：\"></a><strong>检查是否安装完成<strong><strong>：</strong></strong></strong></h4><p> 命令行中输入：pt-summary</p>\n<p>显示如下图所示：说明安装成功！输入【[root@node03 mysql]# pt-query-digest --help】 </p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/1065ff8a2fdbcda9c2ac1e1572a155e0.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/b9d9c028fefa05868018e60a0fe2c872.png\"></p>\n<h4 id=\"工具使用简介：\"><a href=\"#工具使用简介：\" class=\"headerlink\" title=\"工具使用简介：\"></a><strong><strong><strong>工具使用简介：</strong></strong></strong></h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-summary –help</p>\n<p>wget <a href=\"http://percona.com/get/pt-summary\">http://percona.com/get/pt-summary</a></p></blockquote>\n<p><strong><strong><strong>查看服务器信息</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>命令：pt-summary</p></blockquote>\n<p><strong><strong><strong>查看磁盘开销使用信息</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>命令：pt-diskstats</p></blockquote>\n<p><strong><strong><strong>查看mysql数据库信息</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>命令：pt-mysql-summary --user&#x3D;root --password&#x3D;123456</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/893a7f2374f9ab62119bc43db53fe950.png\"></p>\n<p><strong><strong><strong>分析慢查询日志</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>命令：pt-query-digest &#x2F;data&#x2F;mysql&#x2F;data&#x2F;db-3-12-slow.lo</p></blockquote>\n<p><strong><strong><strong>查找mysql的从库和同步状态</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>命令：pt-slave-find --host&#x3D;localhost --user&#x3D;root --password&#x3D;123456</p></blockquote>\n<p><strong><strong><strong>查看mysql的死锁信息</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-deadlock-logger --user&#x3D;root --password&#x3D;123456 localhost</p></blockquote>\n<p><strong><strong><strong>从慢查询日志中分析索引使用情况</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-index-usage slow_20131009.log</p></blockquote>\n<p><strong><strong><strong>查找数据库表中重复的索引</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-duplicate-key-checker --host&#x3D;localhost --user&#x3D;root --password&#x3D;123456</p></blockquote>\n<p><strong><strong><strong>查看mysql表和文件的当前活动IO开销</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-ioprofile</p></blockquote>\n<p><strong><strong><strong>查看不同mysql配置文件的差异</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-config-diff &#x2F;etc&#x2F;my.cnf &#x2F;etc&#x2F;my_master.cnf</p></blockquote>\n<p><strong><strong><strong>pt-find查找mysql表和执行命令，示例如下</strong></strong></strong></p>\n<p>查找数据库里大于2G的表：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-find --user&#x3D;root --password&#x3D;123456 --tablesize +2G</p></blockquote>\n<p>查找10天前创建，MyISAM引擎的表：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-find --user&#x3D;root --password&#x3D;123456 --ctime +10 --engine MyISAM</p></blockquote>\n<p>查看表和索引大小并排序</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-find --user&#x3D;root --password&#x3D;123456 --printf “%T\\t%D.%N\\n” | sort -rn</p></blockquote>\n<p><strong><strong><strong>pt-kill 杀掉符合标准的mysql进程</strong></strong></strong></p>\n<p>显示查询时间大于60秒的查询</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-kill --user&#x3D;root --password&#x3D;123456 --busy-time 60 --print</p></blockquote>\n<p>kill掉大于60秒的查询</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p> pt-kill --user&#x3D;root --password&#x3D;123456 --busy-time 60 --kill</p></blockquote>\n<p><strong><strong><strong>查看mysql授权</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>1、pt-show-grants --user&#x3D;root --password&#x3D;123456</p>\n<p>2、pt-show-grants --user&#x3D;root --password&#x3D;123456 --separate –revoke</p></blockquote>\n<p><strong><strong><strong>验证数据库复制的完整性</strong></strong></strong></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-table-checksum --user&#x3D;root --password&#x3D;123456</p></blockquote>\n<p><strong><strong><strong>附录：</strong></strong></strong></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/88f3f9480ff6f11d44bb42b313edda72.png\"></p>\n<h2 id=\"如何通过慢查日志发现有问题的SQL\"><a href=\"#如何通过慢查日志发现有问题的SQL\" class=\"headerlink\" title=\"如何通过慢查日志发现有问题的SQL****\"></a><strong><strong><strong>如何通过慢查日志发现有问题的</strong></strong></strong><strong>SQL</strong>****</h2><h3 id=\"查询次数多且每次查询占用时间长的sql\"><a href=\"#查询次数多且每次查询占用时间长的sql\" class=\"headerlink\" title=\"查询次数多且每次查询占用时间长的sql\"></a><strong><strong><strong>查询次数多且每次查询占用时间长的sql</strong></strong></strong></h3><p>        通常为pt-query-digest分析的前几个查询；该工具可以很清楚的看出每个SQL执行的次数及百分比等信息，执行的次数多，占比比较大的SQL</p>\n<h3 id=\"IO大的sql\"><a href=\"#IO大的sql\" class=\"headerlink\" title=\"IO大的sql\"></a><strong><strong><strong>IO大的sql</strong></strong></strong></h3><p>        注意pt-query-digest分析中的Rows examine项。扫描的行数越多，IO越大。</p>\n<h3 id=\"未命中的索引的SQL\"><a href=\"#未命中的索引的SQL\" class=\"headerlink\" title=\"未命中的索引的SQL\"></a><strong><strong><strong>未命中的索引的SQL</strong></strong></strong></h3><p>        注意pt-query-digest分析中的Rows examine 和Rows Send的对比。说明该SQL的索引命中率不高，对于这种SQL，我们要重点进行关注。</p>\n<h2 id=\"通过explain查询分析SQL的执行计划\"><a href=\"#通过explain查询分析SQL的执行计划\" class=\"headerlink\" title=\"通过explain查询分析SQL的执行计划****\"></a><strong><strong><strong>通过</strong></strong></strong><strong>explain查询分析SQL的执行计划</strong>****</h2><h3 id=\"使用explain查询SQL的执行计划\"><a href=\"#使用explain查询SQL的执行计划\" class=\"headerlink\" title=\"使用explain查询SQL的执行计划\"></a><strong><strong><strong>使用explain查询SQL的执行计划</strong></strong></strong></h3><p>SQL的执行计划侧面反映出了SQL的执行效率，具体执行方式如下所示：</p>\n<p>在执行的SQL前面加上explain关键词即可；</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/0859bc0464f2e3f28db8a772fbd5f744.png\"></p>\n<h3 id=\"每个字段的说明：\"><a href=\"#每个字段的说明：\" class=\"headerlink\" title=\"每个字段的说明：\"></a><strong><strong><strong>每个字段的说明：</strong></strong></strong></h3><p>1）id列数字越大越先执行，如果说数字一样大，那么就从上往下依次执行，id列为null的就表是这是一个结果集，不需要使用它来进行查询。</p>\n<p>2）select_type列常见的有：</p>\n<p>A：simple：表示不需要union操作或者不包含子查询的简单select查询。有连接查询时，外层的查询为simple，且只有一个</p>\n<p>B：primary：一个需要union操作或者含有子查询的select，位于最外层的单位查询的select_type即为primary。且只有一个</p>\n<p>C：union：union连接的两个select查询，第一个查询是dervied派生表，除了第一个表外，第二个以后的表select_type都是union</p>\n<p>D：dependent union：与union一样，出现在union 或union all语句中，但是这个查询要受到外部查询的影响</p>\n<p>E：union result：包含union的结果集，在union和union all语句中,因为它不需要参与查询，所以id字段为null</p>\n<p>F：subquery：除了from子句中包含的子查询外，其他地方出现的子查询都可能是subquery</p>\n<p>G：dependent subquery：与dependent union类似，表示这个subquery的查询要受到外部表查询的影响</p>\n<p>H：derived：from字句中出现的子查询，也叫做派生表，其他数据库中可能叫做内联视图或嵌套select</p>\n<p>3）table</p>\n<p>显示的查询表名，如果查询使用了别名，那么这里显示的是别名，如果不涉及对数据表的操作，那么这显示为null，如果显示为尖括号括起来的&lt;derived N&gt;就表示这个是临时表，后边的N就是执行计划中的id，表示结果来自于这个查询产生。如果是尖括号括起来的&lt;union M,N&gt;，与&lt;derived N&gt;类似，也是一个临时表，表示这个结果来自于union查询的id为M,N的结果集。</p>\n<p>4）type</p>\n<p>依次从好到差：system，const，eq_ref，ref，fulltext，ref_or_null，unique_subquery，index_subquery，range，index_merge，index，ALL，除了all之外，其他的type都可以使用到索引，除了index_merge之外，其他的type只可以用到一个索引</p>\n<p>A：system：表中只有一行数据或者是空表，且只能用于myisam和memory表。如果是Innodb引擎表，type列在这个情况通常都是all或者index</p>\n<p>B：const：使用唯一索引或者主键，返回记录一定是1行记录的等值where条件时，通常type是const。其他数据库也叫做唯一索引扫描</p>\n<p>C：eq_ref：出现在要连接过个表的查询计划中，驱动表只返回一行数据，且这行数据是第二个表的主键或者唯一索引，且必须为not null，唯一索引和主键是多列时，只有所有的列都用作比较时才会出现eq_ref</p>\n<p>D：ref：不像eq_ref那样要求连接顺序，也没有主键和唯一索引的要求，只要使用相等条件检索时就可能出现，常见与辅助索引的等值查找。或者多列主键、唯一索引中，使用第一个列之外的列作为等值查找也会出现，总之，返回数据不唯一的等值查找就可能出现。</p>\n<p>E：fulltext：全文索引检索，要注意，全文索引的优先级很高，若全文索引和普通索引同时存在时，mysql不管代价，优先选择使用全文索引</p>\n<p>F：ref_or_null：与ref方法类似，只是增加了null值的比较。实际用的不多。</p>\n<p>G：unique_subquery：用于where中的in形式子查询，子查询返回不重复值唯一值</p>\n<p>H：index_subquery：用于in形式子查询使用到了辅助索引或者in常数列表，子查询可能返回重复值，可以使用索引将子查询去重。</p>\n<p>I：range：索引范围扫描，常见于使用&gt;,&lt;,is null,between ,in ,like等运算符的查询中。</p>\n<p>J：index_merge：表示查询使用了两个以上的索引，最后取交集或者并集，常见and ，or的条件使用了不同的索引，官方排序这个在ref_or_null之后，但是实际上由于要读取所个索引，性能可能大部分时间都不如range</p>\n<p>K：index：索引全表扫描，把索引从头到尾扫一遍，常见于使用索引列就可以处理不需要读取数据文件的查询、可以使用索引排序或者分组的查询。</p>\n<p>L：all：这个就是全表扫描数据文件，然后再在server层进行过滤返回符合要求的记录。</p>\n<p>5）possible_keys</p>\n<p>查询可能使用到的索引都会在这里列出来</p>\n<p>6）key</p>\n<p>查询真正使用到的索引，select_type为index_merge时，这里可能出现两个以上的索引，其他的select_type这里只会出现一个。</p>\n<p>7）key_len</p>\n<p>用于处理查询的索引长度，如果是单列索引，那就整个索引长度算进去，如果是多列索引，那么查询不一定都能使用到所有的列，具体使用到了多少个列的索引，这里就会计算进去，没有使用到的列，这里不会计算进去。留意下这个列的值，算一下你的多列索引总长度就知道有没有使用到所有的列了。要注意，mysql的ICP特性使用到的索引不会计入其中。另外，key_len只计算where条件用到的索引长度，而排序和分组就算用到了索引，也不会计算到key_len中。</p>\n<p>8）ref</p>\n<p>如果是使用的常数等值查询，这里会显示const，如果是连接查询，被驱动表的执行计划这里会显示驱动表的关联字段，如果是条件使用了表达式或者函数，或者条件列发生了内部隐式转换，这里可能显示为func</p>\n<p>9）rows</p>\n<p>这里是执行计划中估算的扫描行数，不是精确值</p>\n<p>10）extra</p>\n<p>这个列可以显示的信息非常多，有几十种，常用的有</p>\n<p>A：distinct：在select部分使用了distinc关键字</p>\n<p>B：no tables used：不带from字句的查询或者From dual查询</p>\n<p>C：使用not in()形式子查询或not exists运算符的连接查询，这种叫做反连接。即，一般连接查询是先查询内表，再查询外表，反连接就是先查询外表，再查询内表。</p>\n<p>D：using filesort：排序时无法使用到索引时，就会出现这个。常见于order by和group by语句中</p>\n<p>E：using index：查询时不需要回表查询，直接通过索引就可以获取查询的数据。</p>\n<p>F：using join buffer（block nested loop），using join buffer（batched key accss）：5.6.x之后的版本优化关联查询的BNL，BKA特性。主要是减少内表的循环数量以及比较顺序地扫描查询。</p>\n<p>G：using sort_union，using_union，using intersect，using sort_intersection：</p>\n<p>using intersect：表示使用and的各个索引的条件时，该信息表示是从处理结果获取交集</p>\n<p>using union：表示使用or连接各个使用索引的条件时，该信息表示从处理结果获取并集</p>\n<p>using sort_union和using sort_intersection：与前面两个对应的类似，只是他们是出现在用and和or查询信息量大时，先查询主键，然后进行排序合并后，才能读取记录并返回。</p>\n<p>H：using temporary：表示使用了临时表存储中间结果。临时表可以是内存临时表和磁盘临时表，执行计划中看不出来，需要查看status变量，used_tmp_table，used_tmp_disk_table才能看出来。</p>\n<p>I：using where：表示存储引擎返回的记录并不是所有的都满足查询条件，需要在server层进行过滤。查询条件中分为限制条件和检查条件，5.6之前，存储引擎只能根据限制条件扫描数据并返回，然后server层根据检查条件进行过滤再返回真正符合查询的数据。5.6.x之后支持ICP特性，可以把检查条件也下推到存储引擎层，不符合检查条件和限制条件的数据，直接不读取，这样就大大减少了存储引擎扫描的记录数量。extra列显示using index condition</p>\n<p>J：firstmatch(tb_name)：5.6.x开始引入的优化子查询的新特性之一，常见于where字句含有in()类型的子查询。如果内表的数据量比较大，就可能出现这个</p>\n<p>K：loosescan(m..n)：5.6.x之后引入的优化子查询的新特性之一，在in()类型的子查询中，子查询返回的可能有重复记录时，就可能出现这个</p>\n<p>除了这些之外，还有很多查询数据字典库，执行计划过程中就发现不可能存在结果的一些提示信息</p>\n<p>11）filtered</p>\n<p>使用explain extended时会出现这个列，5.7之后的版本默认就有这个字段，不需要使用explain extended了。这个字段表示存储引擎返回的数据在server层过滤后，剩下多少满足查询的记录数量的比例，注意是百分比，不是具体记录数。</p>\n<p>附图：</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/3c92be0aec625e12d6de6af668eaaa93.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/a4954f4578608dfee410cfb83a3a8c12.png\"></p>\n<h3 id=\"具体慢查询的优化案例\"><a href=\"#具体慢查询的优化案例\" class=\"headerlink\" title=\"具体慢查询的优化案例\"></a><strong><strong><strong>具体慢查询的优化案例</strong></strong></strong></h3><h4 id=\"函数Max-的优化\"><a href=\"#函数Max-的优化\" class=\"headerlink\" title=\"函数Max()的优化****\"></a><strong><strong><strong>函数</strong></strong></strong><strong>Max()的优化</strong>****</h4><p>用途：查询最后支付时间-优化max（）函数</p>\n<p>语句：</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">max</span><span style=\"color: #BABED8\">(payment_date) </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> payment;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/72483f879e8c5f0f48e027df913a6b51.png\"></p>\n<p>执行计划：</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">explain </span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">max</span><span style=\"color: #BABED8\">(payment_date) </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> payment;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/e97441c18d6f7b0b846d79f313fa4528.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/2eda0e74117d94db80e6e0710b17bc7f.png\"></p>\n<p>可以看到显示的执行计划，并不是很高效，可以拖慢服务器的效率，如何优化了？</p>\n<p>创建索引</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">create</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">index</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">inx_paydate</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">on</span><span style=\"color: #BABED8\"> payment(payment_date);</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/1eef1e4edb96b718a3b7ec729cea6295.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/9ceae3879876d00832407305f2daa611.png\"></p>\n<p>索引是顺序操作的，不需要扫描表，执行效率就会比较恒定，</p>\n<h4 id=\"函数Count-的优化\"><a href=\"#函数Count-的优化\" class=\"headerlink\" title=\"函数Count()的优化****\"></a><strong><strong><strong>函数</strong></strong></strong><strong>Count()的优化</strong>****</h4><p>需求：在一条SQL中同时查处2006年和2007年电影的数量</p>\n<p>错误的方式：</p>\n<p>语句：</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">count</span><span style=\"color: #BABED8\">(release_year</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">2006</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">or</span><span style=\"color: #BABED8\"> release_year</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">2007</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> film;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/ce8414e9130e2a178a49d920f2c5fad2.png\"></p>\n<p>2006和2007年分别是多少，判断不出来</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">count</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> film </span><span style=\"color: #F78C6C\">where</span><span style=\"color: #BABED8\"> release_year</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">2006</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">or</span><span style=\"color: #BABED8\"> release_year</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">2007</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/e678b605752f1c452de171e6e00ef6d5.png\"></p>\n<p>正确的编写方式：</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">count</span><span style=\"color: #BABED8\">(release_year</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">2006</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">or</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">null</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">as</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">06films</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">,</span><span style=\"color: #82AAFF\">count</span><span style=\"color: #BABED8\">(release_year</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">2007</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">or</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">null</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">as</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">07films</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> film;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/e571d2145b23e2eb73d36532b6f10136.png\"></p>\n<p>区别：count（*）和count（id）</p>\n<p>创建表并插入语句</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">create</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">t</span><span style=\"color: #BABED8\">(id </span><span style=\"color: #C792EA\">int</span><span style=\"color: #BABED8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">insert into</span><span style=\"color: #BABED8\"> t </span><span style=\"color: #F78C6C\">values</span><span style=\"color: #BABED8\">(</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">),(</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #BABED8\">),(</span><span style=\"color: #F78C6C\">null</span><span style=\"color: #BABED8\">);</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/6f89e50debbd7f5715c2f98697a0c882.png\"></p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">Count（</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">）：</span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">count</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">)</span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> t;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/5fffb1bff8ecde4a1360603c88192626.png\"></p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">Count（id）：</span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">count</span><span style=\"color: #BABED8\">(id)</span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> t;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/7cd92d77dd4c7ee0074316c323f8304c.png\"></p>\n<p>说明：</p>\n<p>Count（id）是不包含null的值</p>\n<p>Count（*）是包含null的值</p>\n<h4 id=\"子查询的优化\"><a href=\"#子查询的优化\" class=\"headerlink\" title=\"子查询的优化\"></a><strong><strong><strong>子查询的优化</strong></strong></strong></h4><p>        子查询是我们在开发过程中经常使用的一种方式，在通常情况下，需要把子查询优化为join查询但在优化是需要注意关联键是否有一对多的关系，要注意重复数据。</p>\n<p>查看我们所创建的t表</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">show </span><span style=\"color: #F78C6C\">create</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #BABED8\"> t;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/37887ecc910d690d62bc99d0fc27124c.png\"></p>\n<p>接下来我们创建一个t1表</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">create</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">t1</span><span style=\"color: #BABED8\">(tid </span><span style=\"color: #C792EA\">int</span><span style=\"color: #BABED8\">);</span></span></code></pre></div><p>并插入一条数据</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/cff91064ce527d45e9032c6bedfdc9c0.png\"></p>\n<p>我们要进行一个子查询，需求：查询t表中id在t1表中tid的所有数据；</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> t </span><span style=\"color: #F78C6C\">where</span><span style=\"color: #BABED8\"> t.id </span><span style=\"color: #F78C6C\">in</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> t1.tid </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> t1);</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/6f40f21288d375fee4331273a34e31f8.png\"></p>\n<p>接下来我们用join的操作来进行操作</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> id </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> t </span><span style=\"color: #F78C6C\">join</span><span style=\"color: #BABED8\"> t1 </span><span style=\"color: #F78C6C\">on</span><span style=\"color: #BABED8\"> t.id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">t1.tid;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/d8208ea654a06ee85e54bcedc88593b3.png\"></p>\n<p> 通过上面结果来看，查询的结果是一致的，我们就将子查询的方式优化为join操作。</p>\n<p>接下来，我们在t1表中再插入一条数据</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">insert into</span><span style=\"color: #BABED8\"> t1 </span><span style=\"color: #F78C6C\">values</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> t1;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/de7e1999ab8960deabc979b21f008c10.png\"></p>\n<p>在这种情况下，如果我们使用子查询方式进行查询，返回的结果就是如下图所示：</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/054c0820e680ca6479103e2ad3fdcc35.png\"></p>\n<p>如果使用join方式进行查找，如下图所示：</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/ba8be5ffbd506fc553398c5aa3c33925.png\"></p>\n<p>在这种情况下出现了一对多的关系，会出现数据的重复，我们为了方式数据重复，不得不使用distinct关键词进行去重操作</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select distinct</span><span style=\"color: #BABED8\"> id </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> t </span><span style=\"color: #F78C6C\">join</span><span style=\"color: #BABED8\"> t1 </span><span style=\"color: #F78C6C\">on</span><span style=\"color: #BABED8\"> t.id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">t1.tid;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/f79d66dccbda3cbc4771bc7955b07a71.png\"></p>\n<p>注意：这个一对多的关系是我们开发过程中遇到的一个坑，出现数据重复，需要大家注意一下。</p>\n<p>例子：查询sandra出演的所有影片：</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">explain </span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> title,release_year,</span><span style=\"color: #F78C6C\">length</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> film</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">where</span><span style=\"color: #BABED8\"> film_id </span><span style=\"color: #F78C6C\">in</span><span style=\"color: #BABED8\"> (</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> film_id </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> film_actor </span><span style=\"color: #F78C6C\">where</span><span style=\"color: #BABED8\"> actor_id </span><span style=\"color: #F78C6C\">in</span><span style=\"color: #BABED8\"> (</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> actor_id </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> actor </span><span style=\"color: #F78C6C\">where</span><span style=\"color: #BABED8\"> first_name</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">sandra</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">));</span></span></code></pre></div><h4 id=\"group-by的优化\"><a href=\"#group-by的优化\" class=\"headerlink\" title=\"group by的优化\"></a><strong><strong><strong>group by的优化</strong></strong></strong></h4><p>最好使用同一表中的列，</p>\n<p>需求：每个演员所参演影片的数量-（影片表和演员表） </p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">explain </span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> actor.first_name,actor.last_name,</span><span style=\"color: #82AAFF\">count</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> sakila.film_actor</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">inner join</span><span style=\"color: #BABED8\"> sakila.actor </span><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\">(actor_id)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">group by</span><span style=\"color: #BABED8\"> film_actor.actor_id;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/9553d1629f10f80e17dff9833d27e962.png\"></p>\n<p>优化后的SQL：</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">explain </span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> actor.first_name,actor.last_name,c.cnt</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> sakila.actor </span><span style=\"color: #F78C6C\">inner join</span><span style=\"color: #BABED8\"> (</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> actor_id,</span><span style=\"color: #82AAFF\">count</span><span style=\"color: #BABED8\">(</span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">as</span><span style=\"color: #BABED8\"> cnt </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> sakila.film_actor </span><span style=\"color: #F78C6C\">group by</span><span style=\"color: #BABED8\"> actor_id</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">)</span><span style=\"color: #F78C6C\">as</span><span style=\"color: #BABED8\"> c </span><span style=\"color: #F78C6C\">using</span><span style=\"color: #BABED8\">(actor_id);</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/b395e95be2b81bbc5899c2924214fa6d.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/49b56e268523be66834cac51af4f7482.png\"></p>\n<p>说明：从上面的执行计划来看，这种优化后的方式没有使用临时文件和文件排序的方式了，取而代之的是使用了索引。查询效率老高了。</p>\n<p>这个时候我们表中的数据比较大，会大量的占用IO操作，优化了sql执行的效率，节省了服务器的资源，因此我们就需要优化。</p>\n<p>注意：</p>\n<p>1、mysql 中using关键词的作用：也就是说要使用using,那么表a和表b必须要有相同的列。</p>\n<p>2、在用Join进行多表联合查询时，我们通常使用On来建立两个表的关系。其实还有一个更方便的关键字，那就是Using。</p>\n<p>3、如果两个表的关联字段名是一样的，就可以使用Using来建立关系，简洁明了。</p>\n<h4 id=\"Limit查询的优化\"><a href=\"#Limit查询的优化\" class=\"headerlink\" title=\"Limit查询的优化\"></a><strong><strong><strong>Limit查询的优化</strong></strong></strong></h4><p>Limit常用于分页处理，时长会伴随order by从句使用，因此大多时候回使用Filesorts这样会造成大量的IO问题。</p>\n<p>例子：</p>\n<p>需求：查询影片id和描述信息，并根据主题进行排序，取出从序号50条开始的5条数据。</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> film_id,</span><span style=\"color: #F78C6C\">description</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> sakila.film </span><span style=\"color: #F78C6C\">order by</span><span style=\"color: #BABED8\"> title </span><span style=\"color: #F78C6C\">limit</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">50</span><span style=\"color: #BABED8\">,</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #BABED8\">;</span></span></code></pre></div><p>执行的结果：</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/171e39743d5fb5115bc063048f513097.png\"></p>\n<p>在查看一下它的执行计划：</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/d77a770fdc40c7b89cb08e43e5498aaa.png\"> 对于这种操作，我们该用什么样的优化方式了？</p>\n<p>优化步骤1：</p>\n<p>使用有索引的列或主键进行order by操作，因为大家知道，innodb是按照主键的逻辑顺序进行排序的。可以避免很多的IO操作。</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> film_id,</span><span style=\"color: #F78C6C\">description</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> sakila.film </span><span style=\"color: #F78C6C\">order by</span><span style=\"color: #BABED8\"> film_id </span><span style=\"color: #F78C6C\">limit</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">50</span><span style=\"color: #BABED8\">,</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #BABED8\">;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/0488932fb6a931ecad29ded212235300.png\"> 查看一下执行计划</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/3b2a14deae75d61ca48f54b0870f94b4.png\"></p>\n<p> 那如果我们获取从500行开始的5条记录，执行计划又是什么样的了？</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">explain </span><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> film_id,</span><span style=\"color: #F78C6C\">description</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> sakila.film </span><span style=\"color: #F78C6C\">order by</span><span style=\"color: #BABED8\"> film_id </span><span style=\"color: #F78C6C\">limit</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">500</span><span style=\"color: #BABED8\">,</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #BABED8\">\\G</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/a84b05fa8447380e715025b78da51701.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/cdd27543208094647f55202786f3c40e.png\"></p>\n<p>随着我们翻页越往后，IO操作会越来越大的，如果一个表有几千万行数据，翻页越后面，会越来越慢，因此我们要进一步的来优化。</p>\n<p>优化步骤2、记录上次返回的主键， 在下次查询时使用主键过滤。（说明：避免了数据量大时扫描过多的记录）</p>\n<p>上次limit是50,5的操作，因此我们在这次优化过程需要使用上次的索引记录值，</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> film_id,</span><span style=\"color: #F78C6C\">description</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> sakila.film  </span><span style=\"color: #F78C6C\">where</span><span style=\"color: #BABED8\"> film_id </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #F78C6C\">55</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">and</span><span style=\"color: #BABED8\"> film_id</span><span style=\"color: #89DDFF\">&lt;=</span><span style=\"color: #F78C6C\">60</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">order by</span><span style=\"color: #BABED8\"> film_id </span><span style=\"color: #F78C6C\">limit</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">,</span><span style=\"color: #F78C6C\">5</span><span style=\"color: #BABED8\">;</span></span></code></pre></div><p>查看执行计划：</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/52d80f29e8ba12812fc704079decb56b.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/26c88b5cf5744012d944ba11be55c9b3.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/96839e4e830925cf7f7ad234dce02e0f.png\"></p>\n<p> 结论：<strong>扫描行数不变，执行计划是很固定，效率也是很固定的</strong></p>\n<p>注意事项：</p>\n<p>主键要顺序排序并连续的，如果主键中间空缺了某一列，或者某几列，会出现列出数据不足5行的数据；如果不连续的情况，建立一个附加的列index_id列，保证这一列数据要自增的，并添加索引即可。</p>\n<h4 id=\"索引的优化\"><a href=\"#索引的优化\" class=\"headerlink\" title=\"索引的优化\"></a><strong><strong><strong>索引的优化</strong></strong></strong></h4><p><strong><strong><strong>1</strong></strong></strong><strong>、什么是索引？</strong>****</p>\n<p>索引的作用相当于图书的目录，可以根据目录中的页码快速找到所需的内容。</p>\n<p>数据库使用索引以找到特定值，然后顺指针找到包含该值的行。在表中建立索引，然后在索引中找到符合查询条件的索引值，最后通过保存在索引中的ROWID（相当于页码）快速找到表中对应的记录。索引的建立是表中比较有指向性的字段，相当于目录，比如说行政区域代码，同一个地域的行政区域代码都是相同的，那么给这一列加上索引，避免让它重复扫描，从而达到优化的目的！</p>\n<p><strong><strong><strong>2、如何创建索引</strong></strong></strong></p>\n<p>在执行CREATE TABLE语句时可以创建索引，也可以单独用CREATE INDEX或ALTER TABLE来为表增加索引。</p>\n<p>1、ALTER TABLE</p>\n<p>ALTER TABLE用来创建普通索引、UNIQUE索引或PRIMARY KEY索引。</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #BABED8\"> table_name </span><span style=\"color: #F78C6C\">ADD</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">INDEX</span><span style=\"color: #BABED8\"> index_name (column_list)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #BABED8\"> table_name </span><span style=\"color: #F78C6C\">ADD</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">UNIQUE</span><span style=\"color: #BABED8\"> (column_list)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #BABED8\"> table_name </span><span style=\"color: #F78C6C\">ADD</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">PRIMARY KEY</span><span style=\"color: #BABED8\"> (column_list)</span></span></code></pre></div><p>说明：其中table_name是要增加索引的表名，column_list指出对哪些列进行索引，多列时各列之间用逗号分隔。索引名index_name可选，缺省时，MySQL将根据第一个索引列赋一个名称。另外，ALTER TABLE允许在单个语句中更改多个表，因此可以在同时创建多个索引。</p>\n<p>2、CREATE INDEX</p>\n<p>CREATE INDEX可对表增加普通索引或UNIQUE索引。</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">CREATE</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">INDEX</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">index_name</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">ON</span><span style=\"color: #BABED8\"> table_name (column_list)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">CREATE</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">UNIQUE INDEX</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">index_name</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">ON</span><span style=\"color: #BABED8\"> table_name (column_list)</span></span></code></pre></div><p>说明：table_name、index_name和column_list具有与ALTER TABLE语句中相同的含义，索引名不可选。另外，不能用CREATE INDEX语句创建PRIMARY KEY索引。</p>\n<p>3、索引类型</p>\n<p>在创建索引时，可以规定索引能否包含重复值。如果不包含，则索引应该创建为PRIMARY KEY或UNIQUE索引。对于单列惟一性索引，这保证单列不包含重复的值。对于多列惟一性索引，保证多个值的组合不重复。</p>\n<p>PRIMARY KEY索引和UNIQUE索引非常类似。</p>\n<p>事实上，PRIMARY KEY索引仅是一个具有名称PRIMARY的UNIQUE索引。这表示一个表只能包含一个PRIMARY KEY，因为一个表中不可能具有两个同名的索引。</p>\n<p>下面的SQL语句对students表在sid上添加PRIMARY KEY索引。</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #BABED8\"> students </span><span style=\"color: #F78C6C\">ADD</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">PRIMARY KEY</span><span style=\"color: #BABED8\"> (</span><span style=\"color: #F78C6C\">sid</span><span style=\"color: #BABED8\">)</span></span></code></pre></div><p>4、删除索引</p>\n<p>可利用ALTER TABLE或DROP INDEX语句来删除索引。类似于CREATE INDEX语句，DROP INDEX可以在ALTER TABLE内部作为一条语句处理，语法如下。  \n </p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">DROP</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">INDEX</span><span style=\"color: #BABED8\"> index_name </span><span style=\"color: #F78C6C\">ON</span><span style=\"color: #BABED8\"> talbe_name</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #BABED8\"> table_name </span><span style=\"color: #F78C6C\">DROP</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">INDEX</span><span style=\"color: #BABED8\"> index_name</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #BABED8\"> table_name </span><span style=\"color: #F78C6C\">DROP</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">PRIMARY KEY</span></span></code></pre></div><p>其中，前两条语句是等价的，删除掉table_name中的索引index_name。</p>\n<p>第3条语句只在删除PRIMARY KEY索引时使用，因为一个表只可能有一个PRIMARY KEY索引，因此不需要指定索引名。如果没有创建PRIMARY KEY索引，但表具有一个或多个UNIQUE索引，则MySQL将删除第一个UNIQUE索引。</p>\n<p>如果从表中删除了某列，则索引会受到影响。对于多列组合的索引，如果删除其中的某列，则该列也会从索引中删除。如果删除组成索引的所有列，则整个索引将被删除。</p>\n<p>   5、查看索引</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #BABED8\">show </span><span style=\"color: #F78C6C\">index</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> tblname;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">show keys </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> tblname;</span></span></code></pre></div><p>   6、什么情况下，使用索引了？</p>\n<p>1、表的主关键字</p>\n<p>2、自动建立唯一索引</p>\n<p>3、表的字段唯一约束</p>\n<p>4、直接条件查询的字段（在SQL中用于条件约束的字段）</p>\n<p>5、查询中与其它表关联的字段</p>\n<p>6、查询中排序的字段（排序的字段如果通过索引去访问那将大大提高排序速度）</p>\n<p>7、查询中统计或分组统计的字段</p>\n<p>8、表记录太少（如果一个表只有5条记录，采用索引去访问记录的话，那首先需访问索引表，再通过索引表访问数据表，一般索引表与数据表不在同一个数据块）</p>\n<p>9、经常插入、删除、修改的表（对一些经常处理的业务表应在查询允许的情况下尽量减少索引）</p>\n<p>10、数据重复且分布平均的表字段（假如一个表有10万行记录，有一个字段A只有T和F两种值，且每个值的分布概率大约为50%，那么对这种表A字段建索引一般不会提高数据库的查询速度。）</p>\n<p>11、经常和主字段一块查询但主字段索引值比较多的表字段</p>\n<p>12、对千万级MySQL数据库建立索引的事项及提高性能的手段</p>\n<p><strong><strong><strong>3</strong></strong></strong><strong>、如何选择合适的列建立索引</strong>****</p>\n<p>1、在where从句，group by从句，order by从句，on从句中的列添加索引</p>\n<p>2、索引字段越小越好（因为数据库数据存储单位是以“页”为单位的，数据存储的越多，IO也会越大）</p>\n<p>3、离散度大的列放到联合索引的前面</p>\n<p>例子：</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">select</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">from</span><span style=\"color: #BABED8\"> payment </span><span style=\"color: #F78C6C\">where</span><span style=\"color: #BABED8\"> staff_id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">2</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">and</span><span style=\"color: #BABED8\"> customer_id </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #F78C6C\">584</span><span style=\"color: #BABED8\">;</span></span></code></pre></div><p>注意:</p>\n<p>是index（staff_id，customer_id）好，还是index（customer_id，staff_id）好</p>\n<p>那我们怎么进行验证离散度好了？</p>\n<p>A、我们先查看一下表结构</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">desc</span><span style=\"color: #BABED8\"> payment;</span></span></code></pre></div><p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/68596529050e79f45761b9846c0d5eff.png\"></p>\n<p>B、分别查看这两个字段中不同的id的数量，数量越多，则表明离散程度越大：因此可以通过下图看出：customer_id 离散程度大。</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/5369281276efb4f18665875aa4732da1.png\"></p>\n<p>结论：由于customer_id 离散程度大，使用index（customer_id，staff_id）好</p>\n<p>C、mysql联合索引</p>\n<p>①命名规则 ：表名_字段名</p>\n<p>1、需要加索引的字段，要在where条件中</p>\n<p>2、数据量少的字段不需要加索引</p>\n<p>3、如果where条件中是OR关系，加索引不起作用</p>\n<p>4、符合最左原则</p>\n<p>②什么是联合索引</p>\n<ol>\n<li>两个或更多个列上的索引被称作联合索引，又被称为是复合索引。</li>\n<li>利用索引中的附加列，您可以缩小搜索的范围，但使用一个具有两列的索引 不同于使用两个单独的索引。复合索引的结构与电话簿类似，人名由姓和名构成，电话簿首先按姓氏对进行排序，然后按名字对有相同姓氏的人进行排序。如果您知 道姓，电话簿将非常有用；如果您知道姓和名，电话簿则更为有用，但如果您只知道名不姓，电话簿将没有用处。</li>\n</ol>\n<p>所以说创建复合索引时，应该仔细考虑列的顺序。对索引中的所有列执行搜索或仅对前几列执行搜索时，复合索引非常有用；仅对后面的任意列执行搜索时，复合索引则没有用处。</p>\n<p><strong><strong><strong>4</strong></strong></strong><strong>、索引优化</strong><strong><strong><strong>SQL的方法</strong></strong></strong></p>\n<p>1、索引的维护及优化（重复及冗余索引）</p>\n<p>增加索引会有利于查询效率，但会降低insert，update，delete的效率，但实际上往往不是这样的，过多的索引会不但会影响使用效率，同时会影响查询效率，这是由于数据库进行查询分析时，首先要选择使用哪一个索引进行查询，如果索引过多，分析过程就会越慢，这样同样的减少查询的效率，因此我们要知道如何增加，有时候要知道维护和删除不需要的索引</p>\n<p>2、如何找到重复和冗余的索引</p>\n<p>重复索引：</p>\n<p>重复索引是指相同的列以相同的顺序建立的同类型的索引，如下表中的 primary key和ID列上的索引就是重复索引</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">create</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">test</span><span style=\"color: #BABED8\">(</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">id </span><span style=\"color: #C792EA\">int</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">not null</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">primary key</span><span style=\"color: #BABED8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">name</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">varchar</span><span style=\"color: #BABED8\">(</span><span style=\"color: #F78C6C\">10</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">not null</span><span style=\"color: #BABED8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">title </span><span style=\"color: #C792EA\">varchar</span><span style=\"color: #BABED8\">(</span><span style=\"color: #F78C6C\">50</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">not null</span><span style=\"color: #BABED8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">unique</span><span style=\"color: #BABED8\">(id)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">)engine</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">innodb;</span></span></code></pre></div><p>冗余索引：</p>\n<p>冗余索引是指多个索引的前缀列相同，或是在联合索引中包含了主键的索引，下面这个例子中key（name，id）就是一个冗余索引。</p>\n<div class=\"language-sql\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">sql</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #F78C6C\">create</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">test</span><span style=\"color: #BABED8\">(</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">id </span><span style=\"color: #C792EA\">int</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">not null</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">primary key</span><span style=\"color: #BABED8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">name</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C792EA\">varchar</span><span style=\"color: #BABED8\">(</span><span style=\"color: #F78C6C\">10</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">not null</span><span style=\"color: #BABED8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">title </span><span style=\"color: #C792EA\">varchar</span><span style=\"color: #BABED8\">(</span><span style=\"color: #F78C6C\">50</span><span style=\"color: #BABED8\">) </span><span style=\"color: #F78C6C\">not null</span><span style=\"color: #BABED8\">,</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #F78C6C\">key</span><span style=\"color: #BABED8\">(</span><span style=\"color: #F78C6C\">name</span><span style=\"color: #BABED8\">,id)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">)engine</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #BABED8\">innodb;</span></span></code></pre></div><p>说明：对于innodb来说，每一个索引后面，实际上都会包含主键，这时候我们建立的联合索引，又人为的把主键包含进去，那么这个时候就是一个冗余索引。</p>\n<p>3、如何查找重复索引</p>\n<p>工具：使用pt-duplicate-key-checker工具检查重复及冗余索引</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-duplicate-key-checker -uroot -padmin -h 127.0.0.1</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/5cfa1744447145931e0a1c71e45e5181.png\"></p>\n<p>4、索引维护的方法</p>\n<p>由于业务变更，某些索引是后续不需要使用的，就要进行删除。</p>\n<p>在mysql中，目前只能通过慢查询日志配合pt-index-usage工具来进行索引使用情况的分析；</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>pt-index-usage -uroot -padmin &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql-host-slow.lo</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/0d75ec753a7b0bd346b9c6ea8d7c5a43.png\"> 附：<a href=\"https://www.percona.com/downloads/\">https://www.percona.com/downloads/</a></p>\n<p><strong><strong><strong>5</strong></strong></strong><strong>、注意事项</strong>****</p>\n<p>设计好MySql的索引可以让你的数据库飞起来，大大的提高数据库效率。设计MySql索引的时候有一下几点注意：</p>\n<p>1，创建索引</p>\n<p>对于查询占主要的应用来说，索引显得尤为重要。很多时候性能问题很简单的就是因为我们忘了添加索引而造成的，或者说没有添加更为有效的索引导致。如果不加索引的话，那么查找任何哪怕只是一条特定的数据都会进行一次全表扫描，如果一张表的数据量很大而符合条件的结果又很少，那么不加索引会引起致命的性能下降。</p>\n<p>但是也不是什么情况都非得建索引不可，比如性别可能就只有两个值，建索引不仅没什么优势，还会影响到更新速度，这被称为过度索引。</p>\n<p>2，复合索引</p>\n<p>比如有一条语句是这样的：select * from users where area&#x3D;’beijing’ and age&#x3D;22;</p>\n<p>如果我们是在area和age上分别创建单个索引的话，由于mysql查询每次只能使用一个索引，所以虽然这样已经相对不做索引时全表扫描提高了很多效率，但是如果在area、age两列上创建复合索引的话将带来更高的效率。如果我们创建了(area, age,salary)的复合索引，那么其实相当于创建了(area,age,salary)、(area,age)、(area)三个索引，这被称为最佳左前缀特性。</p>\n<p>因此我们在创建复合索引时应该将最常用作限制条件的列放在最左边，依次递减。</p>\n<p>3，索引不会包含有NULL值的列</p>\n<p>只要列中包含有NULL值都将不会被包含在索引中，复合索引中只要有一列含有NULL值，那么这一列对于此复合索引就是无效的。所以我们在数据库设计时不要让字段的默认值为NULL。</p>\n<p>4，使用短索引</p>\n<p>对字符串列进行索引，如果可能应该指定一个前缀长度。例如，如果有一个CHAR(255)的 列，如果在前10 个或20 个字符内，多数值是惟一的，那么就不要对整个列进行索引。短索引不仅可以提高查询速度而且可以节省磁盘空间和I&#x2F;O操作。</p>\n<p>5，排序的索引问题</p>\n<p>mysql查询只使用一个索引，因此如果where子句中已经使用了索引的话，那么order by中的列是不会使用索引的。因此数据库默认排序可以符合要求的情况下不要使用排序操作；尽量不要包含多个列的排序，如果需要最好给这些列创建复合索引。</p>\n<p>6，like语句操作</p>\n<p>一般情况下不鼓励使用like操作，如果非使用不可，如何使用也是一个问题。like “%aaa%” 不会使用索引而like “aaa%”可以使用索引。</p>\n<p>7，不要在列上进行运算</p>\n<p>select * from users where</p>\n<p>YEAR(adddate)</p>\n<p>8，不使用NOT IN操作</p>\n<p>NOT IN操作都不会使用索引将进行全表扫描。NOT IN可以NOT EXISTS代替</p>\n<p>Article link： <a href=\"https://tqgoblin.site/post/csdn/MYSQL-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AF%87/\">https://tqgoblin.site/post/csdn/MYSQL-性能优化篇/</a> <div align=left> Author：<a href=\"https://www.tqgoblin.site\"> Stephen </a> </div></p>\n","text":" 目录 为什么要进行数据库优化？ mysql数据库优化 SQL及索引优化 mysql安装与卸载（linux在线安装与卸载） 数据库版本选择 准备数据 表结构关系...","permalink":"/post/csdn/MYSQL-性能优化篇","photos":[],"count_time":{"symbolsCount":"24k","symbolsTime":"21 mins."},"categories":[{"name":"数据库","slug":"数据库","count":2,"path":"api/categories/数据库.json"}],"tags":[{"name":"数据库 mysql","slug":"数据库-mysql","count":1,"path":"api/tags/数据库-mysql.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96%EF%BC%9F\"><span class=\"toc-text\">为什么要进行数据库优化？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">mysql数据库优化</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#SQL%E5%8F%8A%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">SQL及索引优化</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#mysql%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD%EF%BC%88linux%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD%EF%BC%89\"><span class=\"toc-text\">mysql安装与卸载（linux在线安装与卸载）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E9%80%89%E6%8B%A9\"><span class=\"toc-text\">数据库版本选择</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE\"><span class=\"toc-text\">准备数据</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%A1%A8%E7%BB%93%E6%9E%84%E5%85%B3%E7%B3%BB\"><span class=\"toc-text\">表结构关系</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E5%8F%91%E7%8E%B0%E6%9C%89%E9%97%AE%E9%A2%98%E7%9A%84SQL\"><span class=\"toc-text\">如何发现有问题的SQL</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%A3%80%E6%9F%A5%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E6%98%AF%E5%90%A6%E5%BC%80%E5%90%AF%EF%BC%9A\"><span class=\"toc-text\">检查慢查日志是否开启：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E6%97%A5%E5%BF%97%E7%9A%84%E5%8F%98%E9%87%8F%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\">查看所有日志的变量信息</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#MySQL%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E7%9A%84%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F\"><span class=\"toc-text\">MySQL慢查日志的存储格式</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#MySQL%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%EF%BC%88mysqldumpslow%EF%BC%89\"><span class=\"toc-text\">MySQL慢查日志分析工具（mysqldumpslow）****</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">介绍</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%B3%95\"><span class=\"toc-text\">用法</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#MySQL%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7-pt-query-digest\"><span class=\"toc-text\">MySQL慢查日志分析工具(pt-query-digest)</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BB%8B%E7%BB%8D%E5%8F%8A%E4%BD%9C%E7%94%A8\"><span class=\"toc-text\">介绍及作用</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85pt-query-digest%E5%B7%A5%E5%85%B7\"><span class=\"toc-text\">安装pt-query-digest工具</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%EF%BC%88%E6%B3%A8%EF%BC%9A%E5%BF%85%E9%A1%BB%E5%85%88%E8%A6%81%E5%AE%89%E8%A3%85wget%EF%BC%89\"><span class=\"toc-text\">快速安装（注：必须先要安装wget）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%EF%BC%9A\"><span class=\"toc-text\">检查是否安装完成：</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E7%AE%80%E4%BB%8B%EF%BC%9A\"><span class=\"toc-text\">工具使用简介：</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E6%85%A2%E6%9F%A5%E6%97%A5%E5%BF%97%E5%8F%91%E7%8E%B0%E6%9C%89%E9%97%AE%E9%A2%98%E7%9A%84SQL\"><span class=\"toc-text\">如何通过慢查日志发现有问题的SQL****</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E6%AC%A1%E6%95%B0%E5%A4%9A%E4%B8%94%E6%AF%8F%E6%AC%A1%E6%9F%A5%E8%AF%A2%E5%8D%A0%E7%94%A8%E6%97%B6%E9%97%B4%E9%95%BF%E7%9A%84sql\"><span class=\"toc-text\">查询次数多且每次查询占用时间长的sql</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#IO%E5%A4%A7%E7%9A%84sql\"><span class=\"toc-text\">IO大的sql</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9C%AA%E5%91%BD%E4%B8%AD%E7%9A%84%E7%B4%A2%E5%BC%95%E7%9A%84SQL\"><span class=\"toc-text\">未命中的索引的SQL</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%80%9A%E8%BF%87explain%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\"><span class=\"toc-text\">通过explain查询分析SQL的执行计划****</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8explain%E6%9F%A5%E8%AF%A2SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92\"><span class=\"toc-text\">使用explain查询SQL的执行计划</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%AF%8F%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E8%AF%B4%E6%98%8E%EF%BC%9A\"><span class=\"toc-text\">每个字段的说明：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%85%B7%E4%BD%93%E6%85%A2%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">具体慢查询的优化案例</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%87%BD%E6%95%B0Max-%E7%9A%84%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">函数Max()的优化****</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%87%BD%E6%95%B0Count-%E7%9A%84%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">函数Count()的优化****</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">子查询的优化</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#group-by%E7%9A%84%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">group by的优化</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#Limit%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">Limit查询的优化</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BC%98%E5%8C%96\"><span class=\"toc-text\">索引的优化</span></a></li></ol></li></ol></li></ol>","author":{"name":"Stephen","slug":"blog-author","avatar":"../img/logo.png","link":"/","description":"Love and Share","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"分布式日志采集（elk+kafka）","uid":"8da5616698516c85cde26f7cf0077841","slug":"csdn/分布式日志采集（elk+kafka）","date":"2023-03-24T15:15:22.000Z","updated":"2025-02-17T01:58:21.591Z","comments":true,"path":"api/articles/csdn/分布式日志采集（elk+kafka）.json","keywords":"Stephen web3","cover":[],"text":" 目的 分布式系统的日志，每个服务器节点web服务都会产生各自的日志文件，如果想要整合或者排查日志，就需要到每个节点下逐一查看日志文件这样会比较麻烦。所以需要一...","permalink":"/post/csdn/分布式日志采集（elk+kafka）","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"kafka","slug":"kafka","count":4,"path":"api/categories/kafka.json"}],"tags":[{"name":"分布式 elk","slug":"分布式-elk","count":1,"path":"api/tags/分布式-elk.json"}],"author":{"name":"Stephen","slug":"blog-author","avatar":"../img/logo.png","link":"/","description":"Love and Share","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"HBase详解","uid":"845ca224a2ba9eeb409ae729b9b9c1dd","slug":"csdn/HBase详解","date":"2023-02-12T12:54:44.000Z","updated":"2025-02-17T01:58:21.590Z","comments":true,"path":"api/articles/csdn/HBase详解.json","keywords":"Stephen web3","cover":[],"text":" 目录 第 1 章：HBase 简介 1.1 HBase 定义 1.2 HBase 数据模型 1.3 HBase 基本架构 第 2 章：HBase 快速入门 2...","permalink":"/post/csdn/HBase详解","photos":[],"count_time":{"symbolsCount":"43k","symbolsTime":"39 mins."},"categories":[{"name":"大数据","slug":"大数据","count":7,"path":"api/categories/大数据.json"}],"tags":[{"name":"hbase","slug":"hbase","count":1,"path":"api/tags/hbase.json"}],"author":{"name":"Stephen","slug":"blog-author","avatar":"../img/logo.png","link":"/","description":"Love and Share","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}