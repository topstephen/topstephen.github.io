{"title":"kubernetes环境搭建","uid":"0fca9df791e8d84a1257cd45f3a83b63","slug":"csdn/kubernetes环境搭建","date":"2021-05-20T10:16:24.000Z","updated":"2025-02-17T04:22:34.868Z","comments":true,"path":"api/articles/csdn/kubernetes环境搭建.json","keywords":"Stephen web3","cover":[],"content":"<link rel=\"stylesheet\" href=\"/owl.css\"><link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"/assets/js/Meting.min.js\"></script><p><strong>目录</strong></p>\n<p><a href=\"#aignB\">kubernetes 环境搭建</a></p>\n<p><a href=\"#neMD1\">环境说明</a></p>\n<p><a href=\"#a3cb7\">集群搭建方式</a></p>\n<p><a href=\"#xmNSQ\">环境准备</a></p>\n<p><a href=\"#WdaBn\">初始化环境</a></p>\n<p><a href=\"#E1dL4\">安装kubernetes</a></p>\n<p><a href=\"#CUH0u\">安装docker</a></p>\n<p><a href=\"#%C2%A0%E5%AE%89%E8%A3%85kubernetes%E7%BB%84%E4%BB%B6\"> 安装kubernetes组件</a></p>\n<p><a href=\"#WDJaF\">准备集群镜像</a></p>\n<p><a href=\"#mW2eF\">集群初始化</a></p>\n<p><a href=\"#uOJVO\">网络插件的安装</a></p>\n<p><a href=\"#yXLtn\">kubernetes部署nginx</a></p>\n<p><a href=\"#%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E\">版本说明</a></p>\n<hr>\n<h2 id=\"kubernetes-环境搭建\"><a href=\"#kubernetes-环境搭建\" class=\"headerlink\" title=\"kubernetes 环境搭建\"></a>kubernetes 环境搭建</h2><p>1.一主多从: 在学习阶段我们只需要一台Master节点和多台Node节点，搭建简单,有单机发生故障风险，适合用于测试环境</p>\n<p>2.多主多从:多台Master节点和多台Node节点，搭建有一些麻烦,安全系数高，适合用于生产环境</p>\n<h3 id=\"环境说明\"><a href=\"#环境说明\" class=\"headerlink\" title=\"环境说明\"></a>环境说明</h3><p>1.基于云服务器构建kubernetes 环境</p>\n<p>2.本地通过虚拟机构建kubernetes 环境</p>\n<p>安装Centos7.9 准备一个干净的，让后直接克隆三台虚拟机即可</p>\n<p>启动虚拟机过程 ，建议分开的形式启动这三台虚拟机</p>\n<p>虚拟机的搭建可以参考另一个文章：<a href=\"https://blog.csdn.net/qq_40322236/article/details/128632311\" title=\"虚拟机上搭建linux环境\">虚拟机上搭建linux环境</a></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/6bd1a9157293d93f6a44d303dd34774a.png\"></p>\n<h3 id=\"集群搭建方式\"><a href=\"#集群搭建方式\" class=\"headerlink\" title=\"集群搭建方式\"></a>集群搭建方式</h3><p>1.kubeadm</p>\n<p>kubeadm是一个工具，提供kubeadm init 和kubeadm join，用于快速部署Kubernetes集群</p>\n<p>下载地址：<a href=\"https://kubernetes.io/docs/reference/setup-tools/kubeadm/\" title=\"Kubeadm | Kubernetes\">Kubeadm | Kubernetes</a></p>\n<p>2.二进制 从官方下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群　　</p>\n<p>下载地址：<a href=\"https://github.com/kubernetes/kubernetes/releases\" title=\"Releases · kubernetes/kubernetes · GitHub\">Releases · kubernetes&#x2F;kubernetes · GitHub</a></p>\n<p>3.minikube 一个用于快速搭建单节点kubernetes的工具</p>\n<p>下载地址：<a href=\"https://minikube.sigs.k8s.io/docs/start/\" title=\"minikube start | minikube\">minikube start | minikube</a></p>\n<h3 id=\"环境准备\"><a href=\"#环境准备\" class=\"headerlink\" title=\"环境准备\"></a>环境准备</h3><p>1.一个主多个工作节点: 一台Master节点和多台Node节点，搭建简单,但是有单机故障风险，适合用于测试环境</p>\n<p>2.多主节点多工作节点:多台Master节点和多台Node节点，搭建麻烦,安全性高，适合用于生产环境</p>\n<p>程序员初学练习，采用一主多从即可</p>\n<table id=\"humKL\"><tbody><tr><td><p id=\"ub1e08da3\">ip地址</p></td><td><p id=\"ue94565bd\">类型</p></td><td><p id=\"ue3bde485\">操作系统</p></td><td><p id=\"u2552e5c2\">服务配置</p></td></tr><tr><td><p id=\"uf11b8b6c\">192.168.159.180</p></td><td><p id=\"u3b9d9323\">master</p></td><td><p id=\"uc41e3ced\">Centos7.9</p></td><td><p id=\"ucb8f18fd\">2核CPU 2G内存 20G硬盘</p></td></tr><tr><td>192.168.159.181</td><td><p id=\"u688c0423\">node1</p></td><td><p id=\"u5f2b8c09\">Centos7.9</p></td><td><p id=\"u3ba219a2\">2核CPU 2G内存 20G硬盘</p></td></tr><tr><td>192.168.159.182</td><td><p id=\"ua7165f20\">node2</p></td><td><p id=\"u3e6db8a9\">Centos7.9</p></td><td><p id=\"u49c3251c\">2核CPU 2G内存 20G硬盘</p></td></tr></tbody></table>\n\n<p>使用MobaXterm远程连接到这三台服务器</p>\n<h3 id=\"初始化环境\"><a href=\"#初始化环境\" class=\"headerlink\" title=\"初始化环境\"></a>初始化环境</h3><p>需要在这三台服务器上执行以下操作：</p>\n<p>1.检查操作系统的版本</p>\n<p>#此方式下安装kubernetes集群要求Centos版本要在7.5或之上</p>\n<p>cat &#x2F;etc&#x2F;redhat-release</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/e4a9adfa5fa26312aada903b6b7eec63.png\"></p>\n<p>2.主机名解析<br>为了方便后面集群节点间的直接调用，在这配置一下主机名解析, 企业中推荐使用内部DNS服务器<br>#主机名成解析编辑三台服务器的&#x2F;etc&#x2F;hosts文件，添加下面内容</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>vi &#x2F;etc&#x2F;hosts</p>\n<p>192.168.159.180  master<br>192.168.159.181  node1<br>192.168.159.182  node2</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/f4c6120423439e4ea6e83a180f9ba14a.png\"></p>\n<p>3.时间同步</p>\n<p>kubernetes要求集群中的节点时间必须精确一致, 这里直接使用chronyd服务从网络同步时间。<br>企业中建议配置内部的时间同步服务器</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>yum install -y chrony<br>systemctl start chronyd<br>systemctl enable chronyd</p></blockquote>\n<p>4.禁用iptables和firewalld服务</p>\n<p>kubernetes和docker在运行中会产生大量的iptables规则，为了不让系统规则跟它们混淆，直接关闭系统的规则</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p># 1关闭firewalld服务<br>[root@master ~]# systemctl stop firewalld<br>[root@master ~]# systemctl disable firewalld</p>\n<p># 2关闭iptables服务<br>[root@master ~]# systemctl disabled iptables<br>[root@master ~]# systemctl disable iptables</p></blockquote>\n<p>5.关闭selinux</p>\n<p>selinux是linux系统下的一个安全服务，如果不关闭它，在安装集群中会产生各种各样的奇葩问题</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>vi &#x2F;etc&#x2F;selinux&#x2F;config 文件，修改SELINUX的值为disabled<br>#注意修改完毕之后需要重启 linux服务<br>SELINUX&#x3D;disabled</p></blockquote>\n<p> <img src=\"https://i-blog.csdnimg.cn/blog_migrate/e612cb3e6d7c818ceaec069e3eccd455.png\"></p>\n<p>6.禁用swap分区</p>\n<p>swap分区指的是虚拟内存分区，它的作用是在物理内存使用完之后，将磁盘空间虚拟成内存来使用</p>\n<p>启用swap设备会对系统的性能产生非常负面的影响，因此kubernetes要求每个节点都要禁用swap设备</p>\n<p>但是如果因为某些原因确实不能关闭swap分区，就需要在集群安装过程中通过明确的参数进行配置说明</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>#编辑分区配置文件&#x2F;etc&#x2F;fstab,注释掉swap分区一行<br>vi &#x2F;etc&#x2F;fstab</p></blockquote>\n<p> 7.修改Linux内核参数</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>#修改linux的内核参数，添加网桥过滤和地址转发功能<br>vi &#x2F;etc&#x2F;sysctl.d&#x2F;kubernetes.conf文件，添加如下配置:<br>net.bridge.bridge-nf-call-ip6tables &#x3D; 1<br>net.bridge.bridge-nf-call-iptables &#x3D; 1<br>net.ipv4.ip_forward &#x3D; 1<br>#重新加载配置<br>[root@master ~]# sysctl -p<br>#加载网桥过滤模块<br>[root@master ~]# modprobe br_netfilter<br>#查看网桥过滤模块是否加载成功<br>[root@master ~]# lsmod  | grep br_netfilter</p></blockquote>\n<p>8.配置ipvs功能</p>\n<p>在kubernetes中service有两种代理模型，一种是基于iptables的, 一种是基于ipvs的<br>两者比较的话，ipvs的性能明显要高一些,但是如果要使用它，需要手动载入ipvs模块</p>\n<p>k8s service 会使用 ipvs&#x2F;iptables</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p># 1安装ipset和ipvsadm<br>[root@master ~]# yum install ipset ipvsadmin -y</p>\n<p># 2添加需要加载的模块写入脚本文件<br>[ root@master ~]# cat &lt;&lt;EOF &gt; &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules<br>#!&#x2F;bin&#x2F;bash<br>modprobe -- ip_vs<br>modprobe -- ip_vs_rr<br>modprobe -- ip_vs_wrr<br>modprobe -- ip_vs_sh<br>modprobe -- nf_conntrack_ipv4<br>EOF</p>\n<p># 3为脚本文件添加执行权限<br>[root@master ~]# chmod +x &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules</p>\n<p># 4执行脚本文件<br>[root@master ~]# sh +x &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules</p>\n<p># 5查看对应的模块是否加载成功<br>[root@master ~]# lsmod | grep -e ip_vs -e nf_conntrack_ipv4</p></blockquote>\n<p>9.重启Linux系统</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>reboot</p></blockquote>\n<h3 id=\"安装kubernetes\"><a href=\"#安装kubernetes\" class=\"headerlink\" title=\"安装kubernetes\"></a>安装kubernetes</h3><h4 id=\"安装docker\"><a href=\"#安装docker\" class=\"headerlink\" title=\"安装docker\"></a>安装docker</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p># 1切换镜像源<br>[root@master ~]# wget <a href=\"https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\">https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</a> -O &#x2F;etc&#x2F;yum.repos.d&#x2F;docker-ce.repo</p>\n<p>如果报错 -bash: wget: 未找到命令<br>则执行： yum -y install wget<br># 2查看当前镜像源中支持的docker版本<br>[root@master ~]# yum list docker-ce --showduplicates</p>\n<p># 3安装特定版本的docker-ce<br>#指定–setopt&#x3D;obsoletes&#x3D;0,否则yum会自动安装更高版本<br>[root@master ~]# yum install --setopt&#x3D;obsoletes&#x3D;0 docker-ce-18.06.3.ce-3.el7 -y</p>\n<p># 4添加一个配置文件 阿里云加速镜像<br>[root@master ~]# mkdir &#x2F;etc&#x2F;docker<br>[ root@master ~]# cat &lt;&lt;EOF &gt; &#x2F;etc&#x2F;docker&#x2F;daemon.json<br>{<!-- --><br>“exec-opts”: [“native.cgroupdriver&#x3D;systemd”],<br>“registry-mirrors”: [</p>\n<p>“<a href=\"https://62n2zqcw.mirror.aliyuncs.com/\">https://62n2zqcw.mirror.aliyuncs.com</a>“,<br>“<a href=\"https://docker.mirrors.ustc.edu.cn/\">https://docker.mirrors.ustc.edu.cn</a>“,<br>“<a href=\"https://hub-mirror.c.163.com/\">https://hub-mirror.c.163.com</a>“,<br>“<a href=\"https://reg-mirror.qiniu.com/\">https://reg-mirror.qiniu.com</a>“,<br>“<a href=\"https://registry.docker-cn.com/\">https://registry.docker-cn.com</a>“</p>\n<p>]<br>}<br>EOF</p>\n<p># 5启动docker<br>[root@master ~]# systemctl start docker<br>[root@master ~]# systemctl enable docker</p>\n<p># 6检查docker状态和版本<br>[root@master ~]# docker --version</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/5b0717fcfc86463dda2e6c7effa171b7.png\"></p>\n<h4 id=\"安装kubernetes组件\"><a href=\"#安装kubernetes组件\" class=\"headerlink\" title=\"安装kubernetes组件\"></a>安装kubernetes组件</h4><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>#1.由于kubernetes的镜像源在国外，速度比较慢，这里切换成国内的镜像源<br>#2.vi  &#x2F;etc&#x2F;yum.repos.d&#x2F;kubernetes.repo,添加下面的配置<br>[kubernetes]<br>name&#x3D;Kubernetes<br>baseurl&#x3D;<a href=\"http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86/_64\">http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86\\_64</a><br>enabled&#x3D;1<br>gpgcheck&#x3D;0<br>repo_gpgcheck&#x3D;0<br>gpgkey&#x3D;<a href=\"http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\">http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</a><br>      <a href=\"http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\">http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</a></p>\n<p>#3.安装kubeadm、kubelet和kubectl<br>[root@master ~]# yum install --setopt&#x3D;obsoletes&#x3D;0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y<br>#4.配置kubelet的cgroup<br>#5.vi &#x2F;etc&#x2F;sysconfig&#x2F;kubelet,添加下面的配置<br>KUBELET_CGROUP_ARGS&#x3D;”–cgroup-driver&#x3D;systemd”<br>KUBE_PROXY_MODE&#x3D;”ipvs”</p>\n<p>#6.设置kubelet开机自启<br>[root@master ~]# systemctl enable kubelet  \n </p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/855fc31874cb2d14dd7a535b0821bc8a.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/c3a484c0fe863cec3be36450ea07d058.png\"></p>\n<h4 id=\"准备集群镜像\"><a href=\"#准备集群镜像\" class=\"headerlink\" title=\"准备集群镜像\"></a>准备集群镜像</h4><p>在阿里云仓库中存在该镜像 在更改为k8s 官方的名称,同时需要在所有节点操作</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>#在安装k8s集群之前，必须要提前准备好集群需要的镜像，所需镜像可以通过下面命令查看<br>1.kubeadm config images list<br>k8s.gcr.io&#x2F;kube-apiserver:v1.17.17<br>k8s.gcr.io&#x2F;kube-controller-manager:v1.17.17<br>k8s.gcr.io&#x2F;kube-scheduler:v1.17.17<br>k8s.gcr.io&#x2F;kube-proxy:v1.17.17<br>k8s.gcr.io&#x2F;pause:3.1<br>k8s.gcr.io&#x2F;etcd:3.4.3-0<br>k8s.gcr.io&#x2F;coredns:1.6.5<br>2.下载镜像<br>#此镜像在k8s的仓库中,由于网络原因,无法连接，下面提供了-种替代方案<br>images&#x3D;(<br>kube-apiserver:v1.17.4<br>kube-controller-manager:v1.17.4<br>kube-scheduler:v1.17.4<br>kube-proxy:v1.17.4<br>pause:3.1<br>etcd:3.4.3-0<br>coredns:1.6.5<br>)</p>\n<p>for imageName in ${images[@]} ; do<br>docker pull registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;$imageName<br>docker tag registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;$imageName k8s.gcr.io&#x2F;$imageName<br>docker rmi registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;$imageName<br>done</p>\n<p>执行docker images</p></blockquote>\n<p> <img src=\"https://i-blog.csdnimg.cn/blog_migrate/2a0ecb3251afcba4a81a94fbddc6f523.png\"></p>\n<h4 id=\"集群初始化\"><a href=\"#集群初始化\" class=\"headerlink\" title=\"集群初始化\"></a>集群初始化</h4><p>只需要在master节点上执行即可</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>kubeadm init \\<br>--kubernetes-version&#x3D;v1.17.4 \\<br>--pod-network-cidr&#x3D;10.244.0.0&#x2F;16 \\<br>--image-repository registry.aliyuncs.com&#x2F;google_containers \\<br>--service-cidr&#x3D;10.96.0.0&#x2F;12 \\<br>--apiserver-advertise-address&#x3D;192.168.159.180</p>\n<p>注意：–image-repository 需要更改为阿里云加速镜像 <br>--apiserver-advertise-address&#x3D;192.168.159.180  修改为自己的 master的ip。<br>初始化大概需要花费1分钟左右<br>journalctl -xeu kubelet  查看日志</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/b5cafd5aef999063b84285fe941d1092.png\"></p>\n<p>备份，留着在node1,node2节点上执行：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p> kubeadm join 192.168.159.180:6443 --token 75z5j1.oxokr4v2gfekxzna \\<br>    --discovery-token-ca-cert-hash sha256:9afa207224044011b459ca5d3e970d7ab7c5a2ce48a6d8d1eb9f82f9f9ffb422</p></blockquote>\n<p>2.创建必要文件</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>mkdir -p $HOME&#x2F;.kube</p>\n<p>sudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config</p>\n<p>sudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config</p></blockquote>\n<p>3.拷贝备份部分到其他两个节点执行 加入 k8s集群环境 </p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/1ea331fdd1da76341d83f0ddbe48513b.png\"></p>\n<p> <img src=\"https://i-blog.csdnimg.cn/blog_migrate/7f0d278c6fec44e25d75e9493a632859.png\"></p>\n<p>4.执行 kubectl get nodes</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/6b3d12133145ab62c5f3832b7b98dadb.png\"></p>\n<h4 id=\"网络插件的安装\"><a href=\"#网络插件的安装\" class=\"headerlink\" title=\"网络插件的安装\"></a>网络插件的安装</h4><p>kube-flannel.yml 上传到Master节点任意位置</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>-–<br>apiVersion: policy&#x2F;v1beta1<br>kind: PodSecurityPolicy<br>metadata:<br>  name: psp.flannel.unprivileged<br>  annotations:<br>    seccomp.security.alpha.kubernetes.io&#x2F;allowedProfileNames: docker&#x2F;default<br>    seccomp.security.alpha.kubernetes.io&#x2F;defaultProfileName: docker&#x2F;default<br>    apparmor.security.beta.kubernetes.io&#x2F;allowedProfileNames: runtime&#x2F;default<br>    apparmor.security.beta.kubernetes.io&#x2F;defaultProfileName: runtime&#x2F;default<br>spec:<br>  privileged: false<br>  volumes:<br>  - configMap<br>  - secret<br>  - emptyDir<br>  - hostPath<br>  allowedHostPaths:<br>  - pathPrefix: “&#x2F;etc&#x2F;cni&#x2F;net.d”<br>  - pathPrefix: “&#x2F;etc&#x2F;kube-flannel”<br>  - pathPrefix: “&#x2F;run&#x2F;flannel”<br>  readOnlyRootFilesystem: false<br>  # Users and groups<br>  runAsUser:<br>    rule: RunAsAny<br>  supplementalGroups:<br>    rule: RunAsAny<br>  fsGroup:<br>    rule: RunAsAny<br>  # Privilege Escalation<br>  allowPrivilegeEscalation: false<br>  defaultAllowPrivilegeEscalation: false<br>  # Capabilities<br>  allowedCapabilities: [‘NET_ADMIN’, ‘NET_RAW’]<br>  defaultAddCapabilities: []<br>  requiredDropCapabilities: []<br>  # Host namespaces<br>  hostPID: false<br>  hostIPC: false<br>  hostNetwork: true<br>  hostPorts:<br>  - min: 0<br>    max: 65535<br>  # SELinux<br>  seLinux:<br>    # SELinux is unused in CaaSP<br>    rule: ‘RunAsAny’<br>-–<br>kind: ClusterRole<br>apiVersion: rbac.authorization.k8s.io&#x2F;v1<br>metadata:<br>  name: flannel<br>rules:<br>- apiGroups: [‘extensions’]<br>  resources: [‘podsecuritypolicies’]<br>  verbs: [‘use’]<br>  resourceNames: [‘psp.flannel.unprivileged’]<br>- apiGroups:<br>  - “”<br>  resources:<br>  - pods<br>  verbs:<br>  - get<br>- apiGroups:<br>  - “”<br>  resources:<br>  - nodes<br>  verbs:<br>  - list<br>  - watch<br>- apiGroups:<br>  - “”<br>  resources:<br>  - nodes&#x2F;status<br>  verbs:<br>  - patch<br>-–<br>kind: ClusterRoleBinding<br>apiVersion: rbac.authorization.k8s.io&#x2F;v1<br>metadata:<br>  name: flannel<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: flannel<br>subjects:<br>- kind: ServiceAccount<br>  name: flannel<br>  namespace: kube-system<br>-–<br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: flannel<br>  namespace: kube-system<br>-–<br>kind: ConfigMap<br>apiVersion: v1<br>metadata:<br>  name: kube-flannel-cfg<br>  namespace: kube-system<br>  labels:<br>    tier: node<br>    app: flannel<br>data:<br>  cni-conf.json: |<br>    {<!-- --><br>      “name”: “cbr0”,<br>      “cniVersion”: “0.3.1”,<br>      “plugins”: [<br>        {<!-- --><br>          “type”: “flannel”,<br>          “delegate”: {<!-- --><br>            “hairpinMode”: true,<br>            “isDefaultGateway”: true<br>          }<br>        },<br>        {<!-- --><br>          “type”: “portmap”,<br>          “capabilities”: {<!-- --><br>            “portMappings”: true<br>          }<br>        }<br>      ]<br>    }<br>  net-conf.json: |<br>    {<!-- --><br>      “Network”: “10.244.0.0&#x2F;16”,<br>      “Backend”: {<!-- --><br>        “Type”: “vxlan”<br>      }<br>    }<br>-–<br>apiVersion: apps&#x2F;v1<br>kind: DaemonSet<br>metadata:<br>  name: kube-flannel-ds<br>  namespace: kube-system<br>  labels:<br>    tier: node<br>    app: flannel<br>spec:<br>  selector:<br>    matchLabels:<br>      app: flannel<br>  template:<br>    metadata:<br>      labels:<br>        tier: node<br>        app: flannel<br>    spec:<br>      affinity:<br>        nodeAffinity:<br>          requiredDuringSchedulingIgnoredDuringExecution:<br>            nodeSelectorTerms:<br>            - matchExpressions:<br>              - key: kubernetes.io&#x2F;os<br>                operator: In<br>                values:<br>                - linux<br>      hostNetwork: true<br>      priorityClassName: system-node-critical<br>      tolerations:<br>      - operator: Exists<br>        effect: NoSchedule<br>      serviceAccountName: flannel<br>      initContainers:<br>      - name: install-cni-plugin<br>        image: rancher&#x2F;mirrored-flannelcni-flannel-cni-plugin:v1.0.0<br>        command:<br>        - cp<br>        args:<br>        - -f<br>        - &#x2F;flannel<br>        - &#x2F;opt&#x2F;cni&#x2F;bin&#x2F;flannel<br>        volumeMounts:<br>        - name: cni-plugin<br>          mountPath: &#x2F;opt&#x2F;cni&#x2F;bin<br>      - name: install-cni<br>        image: quay.io&#x2F;coreos&#x2F;flannel:v0.15.1<br>        command:<br>        - cp<br>        args:<br>        - -f<br>        - &#x2F;etc&#x2F;kube-flannel&#x2F;cni-conf.json<br>        - &#x2F;etc&#x2F;cni&#x2F;net.d&#x2F;10-flannel.conflist<br>        volumeMounts:<br>        - name: cni<br>          mountPath: &#x2F;etc&#x2F;cni&#x2F;net.d<br>        - name: flannel-cfg<br>          mountPath: &#x2F;etc&#x2F;kube-flannel&#x2F;<br>      containers:<br>      - name: kube-flannel<br>        image: quay.io&#x2F;coreos&#x2F;flannel:v0.15.1<br>        command:<br>        - &#x2F;opt&#x2F;bin&#x2F;flanneld<br>        args:<br>        - –ip-masq<br>        - –kube-subnet-mgr<br>        resources:<br>          requests:<br>            cpu: “100m”<br>            memory: “50Mi”<br>          limits:<br>            cpu: “100m”<br>            memory: “50Mi”<br>        securityContext:<br>          privileged: false<br>          capabilities:<br>            add: [“NET_ADMIN”, “NET_RAW”]<br>        env:<br>        - name: POD_NAME<br>          valueFrom:<br>            fieldRef:<br>              fieldPath: metadata.name<br>        - name: POD_NAMESPACE<br>          valueFrom:<br>            fieldRef:<br>              fieldPath: metadata.namespace<br>        volumeMounts:<br>        - name: run<br>          mountPath: &#x2F;run&#x2F;flannel<br>        - name: flannel-cfg<br>          mountPath: &#x2F;etc&#x2F;kube-flannel&#x2F;<br>      volumes:<br>      - name: run<br>        hostPath:<br>          path: &#x2F;run&#x2F;flannel<br>      - name: cni-plugin<br>        hostPath:<br>          path: &#x2F;opt&#x2F;cni&#x2F;bin<br>      - name: cni<br>        hostPath:<br>          path: &#x2F;etc&#x2F;cni&#x2F;net.d<br>      - name: flannel-cfg<br>        configMap:<br>          name: kube-flannel-cfg</p></blockquote>\n<p>#在master节点执行：</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>[root@master ~]# kubectl apply -f kube-flannel.yml</p></blockquote>\n<p> <img src=\"https://i-blog.csdnimg.cn/blog_migrate/02999ba29c9262c0f1a546c02c4a4b56.png\"></p>\n<p>耐心等待30-60s 查看状态 是否为 ready状态</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>kubectl get nodes</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/96a74f51faab4dd84b2aa350f29d5a56.png\"></p>\n<p>如果还是都是为 notready状态(我没有出现过这种情况，只要等待下图init边测running，上图就ready了)</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/62aee8fa90cabb5726eb17f2d114222b.png\"></p>\n<p>如果status没有变running则需要修改 每台节点的：vi &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;kubeadm-flags.env # 删除–network-plugin&#x3D;cni</p>\n<p>#重新启动</p>\n<p>每台节点都执行一下下面的命令</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>systemctl daemon-reload</p>\n<p>systemctl restart kubelet</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/4b4a4df859215e38a7a2d7858070eb5f.png\"> 如上图所示，k8s就搭建成功了！接下来以nignx部署试下k8s是否搭建成功。</p>\n<h3 id=\"kubernetes部署nginx\"><a href=\"#kubernetes部署nginx\" class=\"headerlink\" title=\"kubernetes部署nginx\"></a>kubernetes部署nginx</h3><p>在Master节点上执行</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>kubectl create deployment nginx --image&#x3D;nginx:1.14-alpine</p>\n<p>kubectl expose deployment nginx --port&#x3D;80 --type&#x3D;NodePort</p>\n<p>kubectl get pods,service</p></blockquote>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/317e046f75c8ef5dcb65565fed53a853.png\"></p>\n<p>docker ps 查看到nginx运行在181节点，使用181地址加上端口号访问一下</p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/4f58751a0e39d205f249a943189252fa.png\"></p>\n<p><img src=\"https://i-blog.csdnimg.cn/blog_migrate/a590f04844c15859779c9c52c3988b6d.png\"></p>\n<p> 可以在master节点查询到pod然后查看pod信息找到nginx落到哪个节点</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>kubectl get pods -–查看正在运行的pod</p>\n<p>kubectl describe pod nginx-6867cdf567-kg88k -–查看正在运行的pod</p></blockquote>\n<p> <img src=\"https://i-blog.csdnimg.cn/blog_migrate/1af91ceec4da0ab6779ebd37e14f623c.png\"></p>\n<p>环境搭建就介绍到这！！</p>\n<h2 id=\"版本说明\"><a href=\"#版本说明\" class=\"headerlink\" title=\"版本说明\"></a>版本说明</h2><p>这次部署的k8s版本是1.17.4，这个版本容器默认还是支持docker的。k8s 从 1.20 版本开始移除了对 Docker 的默认支持,转而默认使用 containerd 作为容器运行时。</p>\n<p>具体的版本变化是:</p>\n<p>• 在 1.20 版本中,Docker 被移除为默认的容器运行时,containerd 取而代之成为默认的容器运行时。</p>\n<p>• 从 1.20 版本开始,如果要继续使用 Docker 作为容器运行时,需要在 kubelet 启动参数中指定 --container-runtime&#x3D;docker 。</p>\n<p>• 1.22 版本将会移除 Docker 支持。从那个版本开始,只支持 containerd 作为容器运行时。</p>\n<p>• 如果集群中有节点运行的是 1.20 以下的 Kubernetes 版本,在升级这些节点到 1.20 或更高版本时,需要使用 --container-runtime&#x3D;docker 参数保持使用 Docker ,然后在以后升级到支持 containerd 的版本时再移除该参数。</p>\n<p>所以简单来说,如果要使用 Kubernetes 1.20 及以上版本,建议使用 containerd 作为默认的容器运行时。要继续使用 Docker,需要在 1.20 版本中手动指定,然后在 1.22 版本升级时需要切换到containerd。</p>\n<p>这一变化的原因是,containerd 比 Docker 更加轻量级、安全和可移植。community希望通过这一切换来简化 Kubernetes 容器解决方案,并减少依赖 dodcker.service 这样的系统服务。</p>\n<p>Article link： <a href=\"https://tqgoblin.site/post/csdn/kubernetes%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/\">https://tqgoblin.site/post/csdn/kubernetes环境搭建/</a> <div align=left> Author：<a href=\"https://www.tqgoblin.site\"> Stephen </a> </div></p>\n","text":"目录 kubernetes 环境搭建 环境说明 集群搭建方式 环境准备 初始化环境 安装kubernetes 安装docker 安装kubernetes组件 准...","permalink":"/post/csdn/kubernetes环境搭建","photos":[],"count_time":{"symbolsCount":"14k","symbolsTime":"12 mins."},"categories":[{"name":"运维","slug":"运维","count":6,"path":"api/categories/运维.json"}],"tags":[{"name":"运维 docker kubernetes","slug":"运维-docker-kubernetes","count":1,"path":"api/tags/运维-docker-kubernetes.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#kubernetes-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\"><span class=\"toc-text\">kubernetes 环境搭建</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">环境说明</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">集群搭建方式</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\"><span class=\"toc-text\">环境准备</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">初始化环境</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85kubernetes\"><span class=\"toc-text\">安装kubernetes</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85docker\"><span class=\"toc-text\">安装docker</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85kubernetes%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">安装kubernetes组件</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%87%86%E5%A4%87%E9%9B%86%E7%BE%A4%E9%95%9C%E5%83%8F\"><span class=\"toc-text\">准备集群镜像</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%9B%86%E7%BE%A4%E5%88%9D%E5%A7%8B%E5%8C%96\"><span class=\"toc-text\">集群初始化</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">网络插件的安装</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#kubernetes%E9%83%A8%E7%BD%B2nginx\"><span class=\"toc-text\">kubernetes部署nginx</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E\"><span class=\"toc-text\">版本说明</span></a></li></ol>","author":{"name":"Stephen","slug":"blog-author","avatar":"../img/logo.png","link":"/","description":"Love and Share","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Kubernetes master集群高可用","uid":"b048cd9598c07b92af477eb0e98be3f6","slug":"csdn/Kubernetes master集群高可用","date":"2021-06-01T09:21:12.000Z","updated":"2025-02-17T04:22:34.720Z","comments":true,"path":"api/articles/csdn/Kubernetes master集群高可用.json","keywords":"Stephen web3","cover":null,"text":"实现方案Kubernetes master高可用一般有三种实现方案: 1. kubeadm 高可用安装使用kubeadm工具安装Kubernetes集群。通过增...","permalink":"/post/csdn/Kubernetes master集群高可用","photos":[],"count_time":{"symbolsCount":"7.7k","symbolsTime":"7 mins."},"categories":[{"name":"运维","slug":"运维","count":6,"path":"api/categories/运维.json"}],"tags":[{"name":"kubernetes 容器","slug":"kubernetes-容器","count":1,"path":"api/tags/kubernetes-容器.json"}],"author":{"name":"Stephen","slug":"blog-author","avatar":"../img/logo.png","link":"/","description":"Love and Share","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Docker","uid":"a48e6dda0c21e40880cba7e763278b04","slug":"csdn/Docker","date":"2021-03-26T08:52:57.000Z","updated":"2025-02-17T03:37:04.096Z","comments":true,"path":"api/articles/csdn/Docker.json","keywords":"Stephen web3","cover":[],"text":"简介与概述1.Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。 Docker 可以让开发者打包他们的应用以及依赖...","permalink":"/post/csdn/Docker","photos":[],"count_time":{"symbolsCount":"19k","symbolsTime":"17 mins."},"categories":[{"name":"运维","slug":"运维","count":6,"path":"api/categories/运维.json"}],"tags":[{"name":"docker 容器","slug":"docker-容器","count":1,"path":"api/tags/docker-容器.json"}],"author":{"name":"Stephen","slug":"blog-author","avatar":"../img/logo.png","link":"/","description":"Love and Share","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}